{% extends 'base.html' %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>

<style>
    /* --- CORE VARIABLES --- */
    :root {
        --primary: #0f172a; /* Slate 900 */
        --accent: #2563eb;  /* Blue 600 */
        --surface: #ffffff;
        --glass: rgba(255, 255, 255, 0.95);
        --text-main: #334155;
        --text-sub: #64748b;
    }

    /* --- GLOBAL STYLES --- */
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }

    /* --- CUSTOM SCROLLBAR --- */
    .premium-scroll::-webkit-scrollbar { width: 5px; }
    .premium-scroll::-webkit-scrollbar-track { background: transparent; }
    .premium-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
    .premium-scroll::-webkit-scrollbar-thumb:hover { background-color: #94a3b8; }

    /* --- RUNNING TEXT --- */
    .marquee-container { position: relative; overflow: hidden; height: 100%; display: flex; align-items: center; }
    .marquee-content {
        white-space: nowrap; will-change: transform;
        animation: marquee-slide 60s linear infinite;
        padding-left: 100%; font-size: 0.75rem; font-weight: 600; color: #475569;
    }
    @keyframes marquee-slide { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

    /* --- PLAYER CONTAINER (16:9) --- */
    .player-wrapper {
        position: relative; width: 100%; padding-top: 56.25%; /* 16:9 Aspect Ratio */
        background: #000; border-radius: 0 0 16px 16px; overflow: hidden;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .video-element { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: fill; }

    /* --- ACCORDION LIST --- */
    .camera-group { margin-bottom: 12px; border: 1px solid #e2e8f0; border-radius: 12px; background: white; overflow: hidden; transition: all 0.3s ease; }
    .group-header {
        padding: 14px 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        background: #fff; transition: background 0.2s;
    }
    .group-header:hover { background: #f8fafc; }
    .group-header.active { background: #eff6ff; border-bottom: 1px solid #dbeafe; }
    .group-title { font-size: 0.75rem; font-weight: 800; color: #1e3a8a; text-transform: uppercase; letter-spacing: 0.05em; display: flex; align-items: center; gap: 10px; }
    .group-icon { font-size: 0.75rem; color: #94a3b8; transition: transform 0.3s; }
    .group-header.active .group-icon { transform: rotate(180deg); color: #2563eb; }
    
    .group-body { max-height: 0; overflow: hidden; transition: max-height 0.4s cubic-bezier(0, 1, 0, 1); background: #fcfcfc; }
    .group-body.open { max-height: 3000px; transition: max-height 0.8s ease-in-out; }

    /* --- LIST ITEM --- */
    .cam-item {
        padding: 12px 18px; border-bottom: 1px solid #f1f5f9; cursor: pointer;
        display: flex; align-items: center; gap: 12px; transition: all 0.2s;
    }
    .cam-item:last-child { border-bottom: none; }
    .cam-item:hover { background-color: #f1f5f9; padding-left: 24px; }
    .cam-item.active { background-color: #eff6ff; border-left: 3px solid #2563eb; }
    .cam-item.active .cam-name { color: #1d4ed8; font-weight: 700; }
    
    /* --- STATUS BADGE --- */
    .live-badge {
        display: inline-flex; align-items: center; gap: 6px;
        background: rgba(16, 185, 129, 0.1); color: #10b981;
        padding: 4px 10px; border-radius: 99px; border: 1px solid rgba(16, 185, 129, 0.2);
        font-size: 0.65rem; font-weight: 800; letter-spacing: 0.05em;
    }
    .pulse-dot { width: 6px; height: 6px; background: #10b981; border-radius: 50%; animation: pulse-green 2s infinite; }
    @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

    /* --- LOADING SPINNER --- */
    .spinner {
        width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1);
        border-radius: 50%; border-top-color: #3b82f6;
        animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
</style>

<div class="min-h-screen w-full flex flex-col text-slate-800" id="main-content">

    <nav class="bg-white/90 backdrop-blur-lg border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-[1920px] mx-auto px-4 lg:px-6 py-3 flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-3 w-full md:w-auto">
                <div class="w-10 h-10 bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl flex items-center justify-center shadow-lg shadow-slate-900/20 text-white">
                    <i class="fa-solid fa-tower-broadcast text-lg"></i>
                </div>
                <div class="leading-tight">
                    <h1 class="text-slate-900 font-extrabold text-lg tracking-tight">KTVDI <span class="text-blue-600">SMART CITY</span></h1>
                    <p class="text-[11px] text-slate-500 font-medium">Integrated Traffic Monitoring System</p>
                </div>
            </div>

            <div class="relative w-full md:w-96 group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i class="fa-solid fa-magnifying-glass text-slate-400 group-focus-within:text-blue-600 transition-colors"></i>
                </div>
                <input type="text" id="search-input" onkeyup="handleSearch()" 
                    class="w-full bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-full py-2.5 pl-11 pr-5 focus:outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-500/10 transition-all font-medium placeholder:text-slate-400"
                    placeholder="Pencarian lokasi kamera...">
            </div>
        </div>
    </nav>

    <div class="max-w-[1920px] mx-auto w-full p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">

        <main class="lg:col-span-9 flex flex-col gap-0 order-1 sticky top-24 z-30 lg:static">
            
            <div class="bg-[#0f172a] text-white px-6 py-4 md:rounded-t-2xl flex justify-between items-center border-b border-white/10 shadow-lg relative z-20">
                <div class="flex items-center gap-4">
                    <div class="live-badge">
                        <div class="pulse-dot"></div>
                        <span>LIVE FEED</span>
                    </div>
                    <div class="h-4 w-px bg-white/20"></div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-0.5">Lokasi Terpantau</span>
                        <span id="active-cam-name" class="text-sm font-bold text-white tracking-wide truncate max-w-[200px] md:max-w-md">Memilih Kamera...</span>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div id="connection-status" class="hidden md:flex items-center gap-2 text-[10px] text-emerald-400 font-bold bg-emerald-500/10 px-2 py-1 rounded border border-emerald-500/20">
                        <i class="fa-solid fa-wifi"></i> <span>STABLE</span>
                    </div>
                </div>
            </div>

            <div class="w-full bg-black shadow-2xl relative md:rounded-b-2xl overflow-hidden group">
                <div class="player-wrapper">
                    <video id="video-element" class="video-element" autoplay muted playsinline></video>

                    <div id="overlay-play" class="absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm cursor-pointer transition-all hidden" onclick="startPlayback()">
                        <div class="w-20 h-20 bg-white/10 border-2 border-white/30 rounded-full flex items-center justify-center backdrop-blur-md shadow-2xl transition-transform hover:scale-110 hover:bg-white/20">
                            <i class="fa-solid fa-play text-white text-3xl ml-1"></i>
                        </div>
                    </div>

                    <div id="overlay-loading" class="absolute inset-0 bg-[#0f172a] z-40 flex flex-col items-center justify-center">
                        <div class="spinner mb-4"></div>
                        <p class="text-slate-400 text-xs font-bold tracking-widest animate-pulse">MENGHUBUNGKAN SATELIT...</p>
                    </div>

                    <div id="overlay-error" class="absolute inset-0 bg-slate-900 z-40 hidden flex flex-col items-center justify-center text-center px-6">
                        <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mb-4 border border-slate-700">
                            <i class="fa-solid fa-video-slash text-slate-500 text-2xl"></i>
                        </div>
                        <h4 class="text-white font-bold mb-1">Sinyal Terputus</h4>
                        <p class="text-slate-400 text-xs mb-6">Kamera sedang offline atau gangguan jaringan.</p>
                        <button onclick="retryStream()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold rounded-full transition shadow-lg">
                            Muat Ulang
                        </button>
                    </div>
                </div>
            </div>

            <div class="mt-4 bg-white border border-slate-200 p-4 md:rounded-xl shadow-sm flex flex-col gap-3">
                <div class="flex flex-wrap justify-between items-center gap-4">
                    <div class="flex items-center gap-3 bg-slate-50 px-4 py-2 rounded-lg border border-slate-100">
                        <i class="fa-regular fa-clock text-blue-600"></i>
                        <div class="text-left">
                            <div id="digital-clock" class="text-slate-900 font-mono text-base font-black leading-none">00:00:00</div>
                            <div id="date-display" class="text-[10px] text-slate-500 font-bold uppercase mt-1">...</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <button onclick="toggleFullscreen()" class="px-4 py-2 bg-white hover:bg-slate-50 text-slate-700 border border-slate-200 rounded-lg text-xs font-bold transition flex items-center gap-2 shadow-sm">
                            <i class="fa-solid fa-expand"></i> Fullscreen
                        </button>
                    </div>
                </div>

                <div class="relative bg-slate-50 border border-slate-200 rounded-lg h-9 flex items-center overflow-hidden">
                    <div class="bg-blue-600 h-full px-4 flex items-center justify-center shrink-0 z-10 shadow-md">
                        <i class="fa-solid fa-circle-info text-white text-xs"></i>
                    </div>
                    <div class="marquee-container w-full">
                        <div class="marquee-content">
                            INFORMASI: Tayangan CCTV ini bersumber dari layanan publik Pemerintah Daerah. KTVDI berfungsi sebagai agregator. Gunakan informasi ini dengan bijak untuk memantau lalu lintas.
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <aside class="lg:col-span-3 flex flex-col h-[65vh] lg:h-[calc(100vh-140px)] bg-white lg:rounded-2xl border border-slate-200 shadow-xl overflow-hidden order-2 mt-0 relative">
            <div class="p-4 border-b border-slate-100 bg-white sticky top-0 z-20 flex justify-between items-center shadow-sm">
                <h3 class="font-extrabold text-slate-800 text-sm flex items-center gap-2">
                    <i class="fa-solid fa-list-ul text-blue-600"></i> DAFTAR LOKASI
                </h3>
                <span class="text-[10px] bg-slate-100 text-slate-600 px-2 py-1 rounded border border-slate-200 font-bold" id="total-cams">0 CAM</span>
            </div>

            <div class="flex-1 overflow-y-auto premium-scroll p-3 bg-slate-50" id="camera-list-container">
                </div>
            
            <div class="p-3 bg-white border-t border-slate-200 text-center text-[10px] text-slate-400 font-medium">
                &copy; 2026 KTVDI Network
            </div>
        </aside>

    </div>
</div>

<script>
    // ==========================================
    // 1. DATA SOURCE (PREMIUM DATA STRUCTURE)
    // ==========================================
    const streamSource = [
        // --- KOTA SEMARANG (70+ Updated) ---
        {city: "KOTA SEMARANG", name: "Kyai Saleh", url: "https://livepantau.semarangkota.go.id/5dfc06a3-5e39-4e07-903e-18298e1ea317/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simpang Letjen Suprapto", url: "https://livepantau.semarangkota.go.id/f589731a-8014-40e9-bd32-573993fd4360/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Mberok In", url: "https://livepantau.semarangkota.go.id/16ec5c7d-78d6-4faa-88f3-ce2377787ab6/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Metro Johar", url: "https://livepantau.semarangkota.go.id/1d3d4d03-fbc6-471a-b86e-796f9d2454a6/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Pemuda - Gajahmada", url: "https://livepantau.semarangkota.go.id/e274caf0-9e7d-4fb4-a0b7-47fcfe5e10ad/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Indaprasta - Imam Bonjol", url: "https://livepantau.semarangkota.go.id/e4a12f24-7e58-4dff-9e5b-e4ef0991b3e5/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Balaikota", url: "https://livepantau.semarangkota.go.id/dd46c7bd-84b8-4cb1-a6e8-d4009da88b22/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Kaligarang", url: "https://livepantau.semarangkota.go.id/bc32b5de-1f3e-4269-857c-9e97a918ea67/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Tugumuda 2", url: "https://livepantau.semarangkota.go.id/74dea63a-7c5c-43d9-96d3-dcaa96f96500/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Tugumuda 3", url: "https://livepantau.semarangkota.go.id/163d3665-9e33-4098-991b-81e1531de941/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Tugumuda", url: "https://livepantau.semarangkota.go.id/8b7644f9-072c-4c62-9952-f77c6e1851dc/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Tugumuda 2 Wide", url: "https://livepantau.semarangkota.go.id/65409efe-d32c-4762-b1b6-be7e0b70ae13/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Tugumuda 3-2", url: "https://livepantau.semarangkota.go.id/6b60e72b-8428-4a13-b19d-1c59937f0aee/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Pucang Gading", url: "https://livepantau.semarangkota.go.id/f4a8da4f-8353-4ea4-beed-801beedca676/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simpang Sambiroto", url: "https://livepantau.semarangkota.go.id/4ffd0954-5fe8-45e0-bbdc-32b0ef74c0f4/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Fatmawati", url: "https://livepantau.semarangkota.go.id/6c9bfcf4-1118-4472-b952-70374425240e/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Counting Pedurungan", url: "https://livepantau.semarangkota.go.id/92c6c558-67b1-4fbe-85ac-13285134d3a4/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Tlogosari", url: "https://livepantau.semarangkota.go.id/718fb9e8-52d5-44ef-9a0d-a4be26ce9640/index.m3u8"},
        {city: "KOTA SEMARANG", name: "DPU Terowongan Soetta", url: "https://livepantau.semarangkota.go.id/d2eb2ac6-ea82-4397-a304-4e644a6fcda2/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Bawah Tol X3W_IN", url: "https://livepantau.semarangkota.go.id/64044538-6b87-45fe-9780-a7d9a772edb0/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Supriyadi", url: "https://livepantau.semarangkota.go.id/e6447de6-60af-428a-abad-3f46f93dff85/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Pasar Banyumanik", url: "https://livepantau.semarangkota.go.id/56255b86-ca94-4308-bc6e-ec99e4fa115a/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Banyumanik Counting Out", url: "https://livepantau.semarangkota.go.id/3a3ab4ac-71d7-4745-96db-3d2a89c88eec/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simp Sukun", url: "https://livepantau.semarangkota.go.id/ddd47c5c-60e9-4e11-9402-9a44e3f80cf0/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Exit Tol Srondol", url: "https://livepantau.semarangkota.go.id/26be91ae-df40-4154-8106-022fbf126091/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Patung Diponegoro", url: "https://livepantau.semarangkota.go.id/71e5c155-44b3-4323-8fa3-8000e02d2fe5/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Bukit Sari", url: "https://livepantau.semarangkota.go.id/3dccd8b8-4d36-4f97-a801-e044f206c628/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Fly Over Jatingaleh", url: "https://livepantau.semarangkota.go.id/3b733f91-8045-4c00-b3ee-58346553c420/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Fly Over Jatingaleh Wide", url: "https://livepantau.semarangkota.go.id/4fc95992-4d96-49bd-a2c1-5c2d53406f03/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Kaliwiru", url: "https://livepantau.semarangkota.go.id/71144509-2bb9-4f55-ade3-bfa3bf01f1eb/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Donbosko", url: "https://livepantau.semarangkota.go.id/5af48766-7d94-439f-9f83-a615fb82d3fa/index.m3u8"},
        {city: "KOTA SEMARANG", name: "SP.Akpol", url: "https://livepantau.semarangkota.go.id/3481ab70-9c70-4213-a954-adc9954d35f4/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Bundaran Diponegoro", url: "https://livepantau.semarangkota.go.id/66d3db83-931c-438e-aed5-8f29a96c7219/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Exit Tol Gayamsari", url: "https://livepantau.semarangkota.go.id/9397276f-ab0f-46a3-988c-4fa6b24782f5/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Lamper - Gajah", url: "https://livepantau.semarangkota.go.id/15dfb463-f960-46bd-9db4-5f75780c8f9e/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simp Kelinci", url: "https://livepantau.semarangkota.go.id/99259845-4513-40d4-b4ff-fe52a731f96b/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simpang Cinde", url: "https://livepantau.semarangkota.go.id/ffd980f2-fd2c-4dfe-919a-ad35d75b0035/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Pasar Kambing 360", url: "https://livepantau.semarangkota.go.id/885c3af0-c04d-4376-8284-e5d8abdd3dac/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Peterongan", url: "https://livepantau.semarangkota.go.id/c2b8e299-695d-4a94-b9d6-149c97d9deb7/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Milo", url: "https://livepantau.semarangkota.go.id/defcf484-e730-462d-912c-b98f7dba92ac/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Bangkong", url: "https://livepantau.semarangkota.go.id/73c3d1e3-28d8-496c-b0a5-763225c10c3d/index.m3u8"},
        {city: "KOTA SEMARANG", name: "MT Haryono", url: "https://livepantau.semarangkota.go.id/aff2b8b8-5d60-43bd-8a6d-bfcf9e83a234/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Sriwijaya 02", url: "https://livepantau.semarangkota.go.id/c0339699-6b20-45dc-8e8d-c3b0ece2ab3e/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Sriwijaya 01", url: "https://livepantau.semarangkota.go.id/d2d3a81d-9d33-4dac-af45-29500714ff87/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Ki Mangun Sarkoro", url: "https://livepantau.semarangkota.go.id/9ea7c028-2b3a-4df5-a8d6-ec8f71de6c53/index.m3u8"},
        {city: "KOTA SEMARANG", name: "JPO Simpang 5", url: "https://livepantau.semarangkota.go.id/ff2be764-eb85-487e-b603-81dc4fcd271f/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Polda 360", url: "https://livepantau.semarangkota.go.id/85f04ddc-61b3-40a0-87ed-2234a7a3703f/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Pahlawan PTZ 01", url: "https://livepantau.semarangkota.go.id/4f138ed7-2fca-4ada-8eec-be832fa6988b/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Pahlawan PTZ 02", url: "https://livepantau.semarangkota.go.id/e7895fae-c1b7-48a4-9efd-d8009d00c947/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Pahlawan 108", url: "https://livepantau.semarangkota.go.id/a174cf48-af7f-4cf9-a35c-4158c05b6745/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Arah Tugu Tunas", url: "https://livepantau.semarangkota.go.id/31c11bab-0ec7-4136-9c74-98266f3f5380/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Arah Pandanaran", url: "https://livepantau.semarangkota.go.id/892f0437-5dc9-45c1-b202-180f4c6d0ed8/index.m3u8"},
        {city: "KOTA SEMARANG", name: "DPU Pahlawan", url: "https://livepantau.semarangkota.go.id/ba6092fc-39c6-4f10-bca4-b4ab49f71246/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simpang 5 1 360", url: "https://livepantau.semarangkota.go.id/7831ff81-dc8a-4c2e-b3ab-d041eda64804/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simpang 5 2", url: "https://livepantau.semarangkota.go.id/2e283d27-b5bc-4f99-9e50-65ee51229031/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simpang Tentrem Mall", url: "https://livepantau.semarangkota.go.id/1d38d1c3-1bd2-43c4-a699-1041897a5755/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Gajahmada", url: "https://livepantau.semarangkota.go.id/37f49225-75cb-4a8f-86dd-7274e128a50f/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Bergota 360", url: "https://livepantau.semarangkota.go.id/c76db3cc-6a7c-46ca-9dd4-1d9000e5f9b7/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Thamrin Pandanaran 360", url: "https://livepantau.semarangkota.go.id/9d44f052-0cf9-4b16-a786-cc6ea7e8d1a5/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Simpang Thamrin", url: "https://livepantau.semarangkota.go.id/9578fde7-aa93-48bd-8cdf-7545458d95e9/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Bathan - Thamrin", url: "https://livepantau.semarangkota.go.id/a0927a42-548d-4a91-89e0-50cb24378613/index.m3u8"},
        {city: "KOTA SEMARANG", name: "Pusat Oleh Oleh", url: "https://livepantau.semarangkota.go.id/02f5d6ea-5b02-4097-b2d0-0f6646dca9f8/index.m3u8"},

        // --- D.I. YOGYAKARTA (LENGKAP) ---
        {city: "D.I. YOGYAKARTA", name: "Malioboro - Simpang Pajeksan", url: "https://cctvjss.jogjakota.go.id/malioboro/Malioboro_22_Simpang_Pajeksan_Suryatmajan.stream/chunklist_w229731190.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang Mandala Krida", url: "https://cctvjss.jogjakota.go.id/atcs/ATCS_Simpang_Mandala_Krida_PTZ.stream/chunklist_w59646757.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Malioboro - Depan Toko Subur", url: "https://cctvjss.jogjakota.go.id/malioboro/Malioboro_2_Depan_Toko_Subur.stream/chunklist_w1876728600.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RTHP Bumen", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_bumen.stream/chunklist_w1247100149.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Taman Waniwulang", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-kp/WanaWil.stream/chunklist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Pertigaan Terminal Wates", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-kp/Terminal.stream/chunklist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RBA Alun-Alun Sisi Barat", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-kp/RBRA.stream/chunklist_w670553311.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Jl Nyoman Arah Gereja", url: "https://cctvjss.jogjakota.go.id/kotabaru/Jl-Nyoman-Oka.stream/chunklist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Demen Glagah", url: "https://mam.jogjaprov.go.id:1937/atcs/DemenGlagah.stream/chunklist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang Mantrigawen PTZ", url: "https://cctvjss.jogjakota.go.id/atcs/ATCS_Mantrigawen_PTZ.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang Karang Tunggal", url: "https://cctvjss.jogjakota.go.id/atcs/ATCS_Lampu_Merah_SopMerah2.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Condong Catur 2", url: "https://cctv.jogjaprov.go.id/cctv-proxy/atcs/Condongcatur2.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Besi", url: "https://cctv.jogjaprov.go.id/cctv-proxy/atcs/Besi.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang Juadi", url: "https://cctv.jogjaprov.go.id/cctv-proxy/atcs-kota/Juadi.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang Tegalgendu PTZ", url: "https://cctvjss.jogjakota.go.id/atcs/ATCS_Simpang_Tegalgendu_PTZ.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang Tugu PTZ 2", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewSimpangTugu.stream/chunklist_w1182543842.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "View 0 KM PTZ", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewNolKilo.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "View Gn Merapi", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewGunungMerapi.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Pandansari Timur", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewPandansariTimur.stream/chunklist_w347333533.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RTHP Segoro Tegalrejo 2", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_segoro_amarto_tegalrejo_2.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Nyai Ageng View Utara", url: "https://mam.jogjaprov.go.id:1937/cctv-kp/Karangnongko.stream/chunklist_w197698033.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang Glagahsari PTZ", url: "https://cctvjss.jogjakota.go.id/atcs/ATCS_Glagahsari_PTZ.stream/chunklist_w609517393.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang Glagahsari", url: "https://cctvjss.jogjakota.go.id/atcs/ATCS_Glagahsari.stream/chunklist_w1045846334.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RTHP Semaki 1", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_semaki_1.stream/chunklist_w1401704022.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RTHP Semaki 2", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_semaki_2.stream/chunklist_w1348168339.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RTHP Gunung Ketur 2", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_gunungketur_2.stream/chunklist_w779845700.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RHTP Gunung Ketur 1", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_gunungketur_1.stream/chunklist_w11536123.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Brontokusuman Belakang 2", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_brontokusuman_blkgKel_2.stream/chunklist_w1107148855.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Malioboro Terang Bulan", url: "https://cctvjss.jogjakota.go.id/malioboro/Malioboro_11_Terang_Bulan.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Malioboro Mal Selatan", url: "https://cctvjss.jogjakota.go.id/malioboro/Malioboro_7_Mall_Selatan.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Malioboro Mutiara Lama", url: "https://cctvjss.jogjakota.go.id/malioboro/Malioboro_8_Mutiara_Lama.stream/playlist.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Malioboro Utara Mall", url: "https://cctvjss.jogjakota.go.id/malioboro/Malioboro_25_Utara_Mall.stream/chunklist_w2134770204.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Simpang BPK", url: "https://cctvjss.jogjakota.go.id/atcs/ATCS_bpk.stream/chunklist_w367961555.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RTHP Pakudaya Kuncen 2", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_pakudaya_pakuncen_2.stream/chunklist_w331129965.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "RTHP Pakudaya Kuncen 1", url: "https://cctvjss.jogjakota.go.id/rthp/rthp_pakudaya_pakuncen_1.stream/chunklist_w934333603.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Gayam", url: "https://cctv.jogjaprov.go.id/cctv-proxy/atcs-kota/Gayam.stream/chunklist_w1124660989.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Sentul", url: "https://cctv.jogjaprov.go.id/cctv-proxy/atcs-kota/Sentul.stream/chunklist_w109375030.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Alun-Alun Utara", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-kp/AlunAlunUtara1.stream/chunklist_w292300010.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "SP3 Terminal Wates", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-kp/Terminal.stream/chunklist_w686073147.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Lapangan Basket", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-kp/LapanganBasket.stream/chunklist_w2123417370.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Depan Plaza Malioboro", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewDepanMall.stream/chunklist_w308264239.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Candi Prambanan", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewCandiPrambanan.stream/chunklist_w1877697172.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Candi Ratu Boko", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewCandiBoko.stream/chunklist_w103317346.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Tebing Breksi", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewBreksi.stream/chunklist_w870274498.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Museum Gn Merapi", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewGunungMerapi.stream/chunklist_w1260618601.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Malioboro Depan Pasar Bringharjo", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewDepanBeringharjo.stream/chunklist_w2067964493.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Candi Sambisari", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewCandiSambisari.stream/chunklist_w1703721545.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Embung Tambakboyo", url: "https://mam.jogjaprov.go.id/cctv-proxy/cctv-public/ViewTambakboyo.stream/chunklist_w782093023.m3u8"},
        {city: "D.I. YOGYAKARTA", name: "Alun-Alun Kidul", url: "https://cctv.jogjaprov.go.id/cctv-proxy/cctv-public/ViewAlunAlunKidul.stream/playlist.m3u8"},

        // --- KOTA PEKALONGAN (LENGKAP) ---
        {city: "KOTA PEKALONGAN", name: "Ponolawen", url: "https://rtsp.pekalongankota.go.id/stream/a23d134a-18c6-4629-8df4-fe9b9777bac5/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Alun Alun Barat", url: "https://rtsp.pekalongankota.go.id/stream/065624f3-dd71-4b40-9106-9b59c81d51c6/channel/3/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Depan Taspen 2", url: "https://rtsp.pekalongankota.go.id/stream/d794f4f7-1b4e-4d1f-a92d-f0920c5f387c/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Dr Cipto", url: "https://rtsp.pekalongankota.go.id/stream/065624f3-dd71-4b40-9106-9b59c81d51c6/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Ruang Amarta", url: "https://rtsp.pekalongankota.go.id/stream/203ede86-a503-4350-816c-9d92643ff605/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Grosir Setono", url: "https://rtsp.pekalongankota.go.id/stream/204f7718-e20c-4229-8ebc-3c5b7470febb/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Grogolan PTZ", url: "https://rtsp.pekalongankota.go.id/stream/442c3e59-0bcc-4651-a6b9-700b7b4f7218/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Depan Balaikota 1", url: "https://rtsp.pekalongankota.go.id/stream/3cf3168a-784e-4f9d-9d1e-15809887e87f/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Gambaran", url: "https://rtsp.pekalongankota.go.id/stream/4ddb8484-2231-4450-9d91-30021a9d94e5/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Polsek Timur", url: "https://rtsp.pekalongankota.go.id/stream/4ddb8484-2231-4450-9d91-30021a9d94e5/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Alun Alun", url: "https://rtsp.pekalongankota.go.id/stream/4ddb8484-2231-4450-9d91-30021a9d94e5/channel/2/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "THR", url: "https://rtsp.pekalongankota.go.id/stream/4ddb8484-2231-4450-9d91-30021a9d94e5/channel/3/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "THR Selatan", url: "https://rtsp.pekalongankota.go.id/stream/4ddb8484-2231-4450-9d91-30021a9d94e5/channel/4/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Stasiun", url: "https://rtsp.pekalongankota.go.id/stream/fa9357ae-1dbc-4f50-a6d1-88649a49a8ae/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Kec Pekalongan Selatan", url: "https://rtsp.pekalongankota.go.id/stream/ec93a215-5852-4ae5-944e-8a6ec558e5e9/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Depan Taspen 1", url: "https://rtsp.pekalongankota.go.id/stream/d794f4f7-1b4e-4d1f-a92d-f0920c5f387c/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Perempatan Kominfo", url: "https://rtsp.pekalongankota.go.id/stream/c285d807-d19f-4dc0-83dc-b1932677fded/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Perempatan Kominfo 2", url: "https://rtsp.pekalongankota.go.id/stream/c1657b7d-1780-4f5c-be0a-96a779cd92b9/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pusri Timur", url: "https://rtsp.pekalongankota.go.id/stream/b05ef4db-a7a7-4622-8b64-fd0085dabe4a/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pusri Barat", url: "https://rtsp.pekalongankota.go.id/stream/b05ef4db-a7a7-4622-8b64-fd0085dabe4a/channel/2/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Ahmad Yani", url: "https://rtsp.pekalongankota.go.id/stream/aae9126d-8149-40e7-9cf2-df7d1a2cbfab/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Ponolawen Timur", url: "https://rtsp.pekalongankota.go.id/stream/a23d134a-18c6-4629-8df4-fe9b9777bac5/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Ponolawen Selatan", url: "https://rtsp.pekalongankota.go.id/stream/a23d134a-18c6-4629-8df4-fe9b9777bac5/channel/2/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pendopo Mataram", url: "https://rtsp.pekalongankota.go.id/stream/3cf3168a-784e-4f9d-9d1e-15809887e87f/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Tirto Timur", url: "https://rtsp.pekalongankota.go.id/stream/723919ec-c0ae-43a9-90f8-a513d5823b27/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Tirto Selatan", url: "https://rtsp.pekalongankota.go.id/stream/723919ec-c0ae-43a9-90f8-a513d5823b27/channel/2/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Ahmad Yani Timur", url: "https://rtsp.pekalongankota.go.id/stream/204f7718-e20c-4229-8ebc-3c5b7470febb/channel/3/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Parkir Depan Kominfo", url: "https://rtsp.pekalongankota.go.id/stream/092dc478-ba66-4939-8fd0-b8796cfd89a0/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Dharma Bakti Timur", url: "https://rtsp.pekalongankota.go.id/stream/504ddc51-6bb8-4355-a6b3-e1fc4b8e3e8d/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Dharma Bakti Barat", url: "https://rtsp.pekalongankota.go.id/stream/504ddc51-6bb8-4355-a6b3-e1fc4b8e3e8d/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Dharma Bakti Selatan", url: "https://rtsp.pekalongankota.go.id/stream/504ddc51-6bb8-4355-a6b3-e1fc4b8e3e8d/channel/2/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pertigaan Podosugih Utara", url: "https://rtsp.pekalongankota.go.id/stream/69518725-7264-4b56-a685-7dbddf7cd039/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Muhammadiyah Barat", url: "https://rtsp.pekalongankota.go.id/stream/a561e384-c065-41f6-84fa-32ec581f133f/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Matahari", url: "https://rtsp.pekalongankota.go.id/stream/065624f3-dd71-4b40-9106-9b59c81d51c6/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Terminal Tengah", url: "https://rtsp.pekalongankota.go.id/stream/0b2a0c4c-fb26-4318-bbeb-86d6bcdf2fa3/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Terminal Timur", url: "https://rtsp.pekalongankota.go.id/stream/0b2a0c4c-fb26-4318-bbeb-86d6bcdf2fa3/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pertigaan Podo Sugih Timur", url: "https://rtsp.pekalongankota.go.id/stream/20f63cfc-3f39-440f-b604-4d356da5315d/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Polsek Timur (Alt)", url: "https://rtsp.pekalongankota.go.id/stream/390c6bc2-f6eb-46f6-be5a-a7bd6651d110/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Grogolan Timur", url: "https://rtsp.pekalongankota.go.id/stream/442c3e59-0bcc-4651-a6b9-700b7b4f7218/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Mataram Pojok Utara", url: "https://rtsp.pekalongankota.go.id/stream/4e2c3d4b-7cb1-40fa-9e56-3cfc9693412f/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pertigaan Kel Klego", url: "https://rtsp.pekalongankota.go.id/stream/98520500-cf21-47b5-ae30-eb767f681aba/channel/0/hlsll/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pertigaan Kel Klego 2", url: "https://rtsp.pekalongankota.go.id/stream/98520500-cf21-47b5-ae30-eb767f681aba/channel/1/hlsll/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Area Sorogenen", url: "https://rtsp.pekalongankota.go.id/stream/065624f3-dd71-4b40-9106-9b59c81d51c6/channel/2/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Stasiun Timur", url: "https://rtsp.pekalongankota.go.id/stream/fa9357ae-1dbc-4f50-a6d1-88649a49a8ae/channel/1/hlsll/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pusri Timur (Superindo)", url: "https://rtsp.pekalongankota.go.id/stream/b05ef4db-a7a7-4622-8b64-fd0085dabe4a/channel/0/hlsll/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Posis Barat", url: "https://rtsp.pekalongankota.go.id/stream/390c6bc2-f6eb-46f6-be5a-a7bd6651d110/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Posis Utara", url: "https://rtsp.pekalongankota.go.id/stream/390c6bc2-f6eb-46f6-be5a-a7bd6651d110/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Posis Timur", url: "https://rtsp.pekalongankota.go.id/stream/390c6bc2-f6eb-46f6-be5a-a7bd6651d110/channel/2/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Jalan Kurinci (Alfamart)", url: "https://rtsp.pekalongankota.go.id/stream/f7047bbb-7385-4e0a-b0b4-58594772a8e1/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Kec Pekalongan Utara", url: "https://rtsp.pekalongankota.go.id/stream/097799c5-4130-48b8-8c94-869b1960d0c1/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Kali Bremi", url: "https://rtsp.pekalongankota.go.id/stream/a051a871-44ce-4a0e-9c30-6fc3455904b1/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Alun Alun Selatan", url: "https://rtsp.pekalongankota.go.id/stream/18aa9cf3-ae88-4d54-9831-199807df3d45/channel/0/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Pertigaan Alun Alun Selatan", url: "https://rtsp.pekalongankota.go.id/stream/18aa9cf3-ae88-4d54-9831-199807df3d45/channel/1/hls/live/index.m3u8"},
        {city: "KOTA PEKALONGAN", name: "Menara TWL Pasir Kencana", url: "https://rtsp.pekalongankota.go.id/stream/e1c404e6-19f1-464c-9754-e8d53546ff8b/channel/0/hlsll/live/index.m3u8"}
    ];

    // ==========================================
    // 2. PLAYER LOGIC (HLS + ERROR HANDLING)
    // ==========================================
    let hls;
    let activeStreamIndex = 0;
    const video = document.getElementById('video-element');
    const statusText = document.getElementById('active-cam-name');
    const loadingOverlay = document.getElementById('overlay-loading');
    const errorOverlay = document.getElementById('overlay-error');
    const playOverlay = document.getElementById('overlay-play');

    function initPlayer() {
        // Grouping Data
        renderAccordionList();
        
        // Initial Load (Default Camera)
        if (streamSource.length > 0) {
            loadStream(0);
        }

        // Clock Update
        setInterval(updateClock, 1000);
        updateClock();
    }

    function loadStream(index) {
        if (index < 0 || index >= streamSource.length) return;
        activeStreamIndex = index;
        const stream = streamSource[index];

        // UI Updates
        statusText.innerText = `${stream.city} - ${stream.name}`;
        loadingOverlay.classList.remove('hidden');
        errorOverlay.classList.add('hidden');
        playOverlay.classList.add('hidden');

        // Highlight Active Item in List
        document.querySelectorAll('.cam-item').forEach(el => el.classList.remove('active'));
        const activeItem = document.getElementById(`cam-${index}`);
        if(activeItem) {
            activeItem.classList.add('active');
            activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // HLS Logic
        if (Hls.isSupported()) {
            if (hls) hls.destroy();
            hls = new Hls({
                enableWorker: true,
                lowLatencyMode: true,
                backBufferLength: 90
            });
            
            hls.loadSource(stream.url);
            hls.attachMedia(video);
            
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        loadingOverlay.classList.add('hidden');
                        playOverlay.classList.remove('hidden'); // Show manual play if autoplay blocked
                    });
                }
            });

            hls.on(Hls.Events.ERROR, (event, data) => {
                if (data.fatal) {
                    switch (data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            console.error("Network Error, trying to recover...");
                            hls.startLoad();
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            console.error("Media Error, trying to recover...");
                            hls.recoverMediaError();
                            break;
                        default:
                            hls.destroy();
                            showErrorState();
                            break;
                    }
                }
            });

        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // Safari Native HLS
            video.src = stream.url;
            video.addEventListener('loadedmetadata', () => {
                video.play().catch(() => playOverlay.classList.remove('hidden'));
            });
            video.addEventListener('error', showErrorState);
        }
    }

    video.addEventListener('playing', () => {
        loadingOverlay.classList.add('hidden');
        playOverlay.classList.add('hidden');
    });

    video.addEventListener('waiting', () => {
        loadingOverlay.classList.remove('hidden');
    });

    function showErrorState() {
        loadingOverlay.classList.add('hidden');
        errorOverlay.classList.remove('hidden');
    }

    function retryStream() {
        loadStream(activeStreamIndex);
    }

    function startPlayback() {
        video.play();
        playOverlay.classList.add('hidden');
    }

    // ==========================================
    // 3. UI RENDERER (ACCORDION)
    // ==========================================
    function renderAccordionList() {
        const container = document.getElementById('camera-list-container');
        container.innerHTML = '';
        
        // Grouping Data
        const groups = {};
        streamSource.forEach((s, i) => {
            if (!groups[s.city]) groups[s.city] = [];
            groups[s.city].push({ ...s, originalIndex: i });
        });

        // Render HTML
        for (const [city, items] of Object.entries(groups)) {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'camera-group';
            
            const header = document.createElement('div');
            header.className = 'group-header';
            header.onclick = () => toggleGroup(header);
            header.innerHTML = `
                <div class="group-title">
                    <i class="fa-solid fa-map-location-dot text-blue-600"></i> ${city}
                </div>
                <i class="fa-solid fa-chevron-down group-icon"></i>
            `;

            const body = document.createElement('div');
            body.className = 'group-body';
            
            items.forEach(item => {
                const row = document.createElement('div');
                row.className = 'cam-item';
                row.id = `cam-${item.originalIndex}`;
                row.onclick = () => loadStream(item.originalIndex);
                row.innerHTML = `
                    <i class="fa-solid fa-video text-slate-400 text-xs"></i>
                    <span class="cam-name text-xs text-slate-600 font-medium truncate">${item.name}</span>
                `;
                body.appendChild(row);
            });

            groupDiv.appendChild(header);
            groupDiv.appendChild(body);
            container.appendChild(groupDiv);
        }

        document.getElementById('total-cams').innerText = `${streamSource.length} CAM`;
    }

    function toggleGroup(header) {
        header.classList.toggle('active');
        const body = header.nextElementSibling;
        body.classList.toggle('open');
    }

    // ==========================================
    // 4. SEARCH FUNCTION
    // ==========================================
    function handleSearch() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const groups = document.querySelectorAll('.camera-group');
        let foundCount = 0;

        groups.forEach(group => {
            const items = group.querySelectorAll('.cam-item');
            let hasVisibleItem = false;

            items.forEach(item => {
                const text = item.innerText.toLowerCase();
                if (text.includes(term)) {
                    item.style.display = 'flex';
                    hasVisibleItem = true;
                    foundCount++;
                } else {
                    item.style.display = 'none';
                }
            });

            if (term.length > 0) {
                // Auto expand if matches found
                const body = group.querySelector('.group-body');
                const header = group.querySelector('.group-header');
                if (hasVisibleItem) {
                    group.style.display = 'block';
                    body.classList.add('open');
                    header.classList.add('active');
                } else {
                    group.style.display = 'none';
                }
            } else {
                // Reset to default state
                group.style.display = 'block';
                const body = group.querySelector('.group-body');
                const header = group.querySelector('.group-header');
                body.classList.remove('open');
                header.classList.remove('active');
                items.forEach(i => i.style.display = 'flex');
            }
        });
    }

    // ==========================================
    // 5. UTILITIES
    // ==========================================
    function updateClock() {
        const now = new Date();
        document.getElementById('digital-clock').innerText = now.toLocaleTimeString('id-ID', {hour12: false});
        document.getElementById('date-display').innerText = now.toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
    }

    function toggleFullscreen() {
        const elem = document.querySelector('.player-wrapper');
        if (!document.fullscreenElement) {
            if (elem.requestFullscreen) elem.requestFullscreen();
            else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
        } else {
            if (document.exitFullscreen) document.exitFullscreen();
        }
    }

    // Start Everything
    document.addEventListener('DOMContentLoaded', initPlayer);

</script>
{% endblock %}
