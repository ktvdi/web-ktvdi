<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>ðŸ“º Daftar Siaran TV Digital</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #0077cc; }
        select { margin: 10px 0; padding: 5px; }
        .card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            background: #f9f9f9;
        }
        ul { margin: 0; padding-left: 20px; }
    </style>
</head>
<body>
    <h1>ðŸ“º Daftar Siaran TV Digital</h1>

    <!-- Filter Provinsi -->
    <label>Pilih Provinsi:</label>
    <select id="provinsi">
        <option value="">-- Pilih Provinsi --</option>
        {% for p in provinsi_list %}
            <option value="{{ p }}">{{ p }}</option>
        {% endfor %}
    </select>

    <!-- Filter Wilayah -->
    <label>Pilih Wilayah:</label>
    <select id="wilayah">
        <option value="">-- Pilih Wilayah --</option>
    </select>

    <!-- Filter MUX -->
    <label>Pilih MUX:</label>
    <select id="mux">
        <option value="">-- Pilih MUX --</option>
    </select>

    <div id="detail"></div>

    <script>
        $(document).ready(function() {
            // Saat pilih provinsi
            $("#provinsi").change(function() {
                var provinsi = $(this).val();
                if (provinsi) {
                    $.getJSON("/get_wilayah", { provinsi: provinsi }, function(data) {
                        $("#wilayah").empty().append('<option value="">-- Pilih Wilayah --</option>');
                        $.each(data.wilayah, function(i, w) {
                            $("#wilayah").append('<option value="' + w + '">' + w + '</option>');
                        });
                        $("#mux").empty().append('<option value="">-- Pilih MUX --</option>');
                        $("#detail").html("");
                    });
                }
            });

            // Saat pilih wilayah
            $("#wilayah").change(function() {
                var provinsi = $("#provinsi").val();
                var wilayah = $(this).val();
                if (wilayah) {
                    $.getJSON("/get_mux", { provinsi: provinsi, wilayah: wilayah }, function(data) {
                        $("#mux").empty().append('<option value="">-- Pilih MUX --</option>');
                        $.each(data.mux, function(i, m) {
                            $("#mux").append('<option value="' + m + '">' + m + '</option>');
                        });
                        $("#detail").html("");
                    });
                }
            });

            // Saat pilih mux
            $("#mux").change(function() {
                var provinsi = $("#provinsi").val();
                var wilayah = $("#wilayah").val();
                var mux = $(this).val();
                if (mux) {
                    $.getJSON("/get_siaran", { provinsi: provinsi, wilayah: wilayah, mux: mux }, function(data) {
                        var html = '<div class="card">';
                        html += "<h3>ðŸ“¡ " + mux + "</h3>";
                        html += "<p><strong>Update:</strong> " + (data.last_updated_date || "-") + " " + (data.last_updated_time || "") + "</p>";
                        html += "<p><strong>Oleh:</strong> " + (data.last_updated_by_name || "-") + " (" + (data.last_updated_by_username || "-") + ")</p>";
                        html += "<h4>ðŸ“º Daftar Siaran:</h4><ul>";
                        $.each(data.siaran, function(i, s) {
                            html += "<li>" + s + "</li>";
                        });
                        html += "</ul></div>";
                        $("#detail").html(html);
                    });
                }
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
