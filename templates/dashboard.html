<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Siaran</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-light p-4">

<div class="container">
  <h2 class="mb-4">ðŸ“º Dashboard Siaran</h2>
  <p>Halo, <strong>{{ username }}</strong></p>
  <a href="{{ url_for('logout') }}" class="btn btn-secondary btn-sm mb-3">Logout</a>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="card mb-4">
    <div class="card-header">Tambah Data Siaran</div>
    <div class="card-body">
      <form method="POST" action="{{ url_for('add_siaran') }}">
        <div class="mb-2">
          <label>Provinsi:</label>
          <select name="provinsi" id="provinsi" class="form-select" required>
            <option value="">-- Pilih Provinsi --</option>
            {% for key, name in provinsi_data.items() %}
              <option value="{{ key }}">{{ name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-2">
          <label>Wilayah Layanan:</label>
          <input type="text" id="wilayah" name="wilayah" class="form-control" readonly required>
        </div>

        <div class="mb-2">
          <label>Nama MUX:</label>
          <input type="text" name="channel" class="form-control" placeholder="UHF 36 - Indosiar" required>
        </div>

        <div class="mb-2">
          <label>Daftar Siaran (pisahkan dengan koma):</label>
          <input type="text" name="siaran" class="form-control" placeholder="Contoh: RCTI, SCTV, TVRI" required>
        </div>

        <button type="submit" class="btn btn-primary">Tambah</button>
      </form>
    </div>
  </div>

  <h4>ðŸ“¡ Data Siaran Tersimpan:</h4>
  {% if siaran_data %}
    {% for prov, wilayahs in siaran_data.items() %}
      <h5 class="mt-3">{{ prov }}</h5>
      <ul>
        {% for wilayah, channels in wilayahs.items() %}
          <li>
            <strong>{{ wilayah }}</strong>
            <ul>
              {% for channel, data in channels.items() %}
                <li>
                  <strong>{{ channel }}</strong>
                  <ul>
                    {% for s in data.siaran %}
                      <li>{{ s }}</li>
                    {% endfor %}
                  </ul>
                  <form method="POST" action="{{ url_for('delete_siaran') }}" style="display:inline;">
                    <input type="hidden" name="provinsi" value="{{ prov }}">
                    <input type="hidden" name="wilayah" value="{{ wilayah }}">
                    <input type="hidden" name="channel" value="{{ channel }}">
                    <button type="submit" class="btn btn-danger btn-sm">Hapus</button>
                  </form>
                </li>
              {% endfor %}
            </ul>
          </li>
        {% endfor %}
      </ul>
    {% endfor %}
  {% else %}
    <p><em>Belum ada data siaran.</em></p>
  {% endif %}
</div>

<script>
  // Saat provinsi dipilih, otomatis isi wilayah
  $('#provinsi').change(function() {
    const provKey = $(this).val();
    if (provKey) {
      $.getJSON(`/get_wilayah/${provKey}`, function(data) {
        $('#wilayah').val(data.wilayah);
      });
    } else {
      $('#wilayah').val('');
    }
  });
</script>

</body>
</html>
