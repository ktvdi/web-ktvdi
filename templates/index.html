{% extends "base.html" %}

{% block title %}Komunitas TV Digital Indonesia{% endblock %}

{% block body_class %}home-page{% endblock %}

{% block content %}
<section class="relative bg-white pt-10 pb-20 overflow-hidden">
    <div class="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-brand-surface rounded-full blur-3xl opacity-70 animate-pulse-slow"></div>
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="flex flex-col lg:flex-row items-center gap-12">
            
            <div class="flex-1 text-center lg:text-left">
                <div class="inline-flex items-center gap-2 px-3 py-1 bg-white border border-brand-blue/20 text-brand-blue text-xs font-bold rounded-full mb-6 shadow-sm">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    Menyambut Piala Dunia 2026
                </div>

                <h1 class="text-4xl md:text-6xl font-extrabold text-brand-navy leading-tight mb-6">
                    Selamat Datang di <br>
                    <span class="bg-clip-text text-transparent bg-gradient-to-r from-brand-blue via-sky-400 to-brand-blue bg-[length:200%_auto] animate-[marquee_3s_linear_infinite]">
                        Komunitas TV Digital Indonesia
                    </span>
                </h1>

                <div class="text-slate-500 text-sm md:text-base leading-relaxed mb-8 max-w-2xl mx-auto lg:mx-0 text-justify space-y-4 font-medium">
                    <p>
                        Kami menyambut Anda di pusat informasi terdepan untuk transisi penyiaran digital di Indonesia. Platform ini dikelola oleh komunitas untuk memastikan setiap warga negara mendapatkan hak atas informasi dan hiburan yang layak.
                    </p>
                    <p>
                        <span class="text-brand-blue font-bold">Siapkah Anda untuk World Cup 2026?</span> 
                        Teknologi DVB-T2 adalah kunci menikmati perhelatan akbar ini dengan kualitas High Definition (HD) yang tajam, jernih, dan tanpa biaya bulanan. Jangan biarkan "semut" mengganggu momen gol Anda.
                    </p>
                    <p>
                        Gunakan data frekuensi MUX kami yang mencakup seluruh wilayah dari Sabang hingga Merauke untuk mengarahkan antena UHF Anda secara presisi. Mari wujudkan pemerataan digital bagi Indonesia.
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Tombol Toggle -->
    <button id="chat-toggle" style="display: none;"><i class="fa-solid fa-comments"></i></button>

    <!-- Chat Popup -->
    <div class="chatbot" id="chatbot" style="display: none;">
      <h1>ChatKTVDI</h1>
      <div class="chat-body" id="chat-body">
        <!-- Pesan muncul di sini -->
      </div>
      <div class="input-area">
        <textarea id="prompt" placeholder="Tulis pertanyaan..."></textarea>
        <button class="send-btn" onclick="sendPrompt()"><i class="fa-solid fa-paper-plane"></i></button>
      </div>
    </div>

    <script>
      // Toggle Chat Widget
      const toggleBtn = document.getElementById("chat-toggle");
      const chatbot = document.getElementById("chatbot");
      const chatBody = document.getElementById("chat-body");
      const promptInput = document.getElementById("prompt");

      toggleBtn.addEventListener("click", () => {
        chatbot.style.display = chatbot.style.display === "flex" ? "none" : "flex";
      });

      // Fungsi kirim prompt ke server Flask
      async function sendPrompt() {
        const prompt = promptInput.value.trim();
        if (!prompt) return;

        // Tampilkan pesan user
        appendMessage(prompt, "user");
        promptInput.value = "";

        // Tambahkan placeholder sementara
        const thinkingMsg = appendMessage("⏳ Sedang memproses...", "bot");

        try {
          const res = await fetch("/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt })
          });

          const data = await res.json();
          chatBody.removeChild(thinkingMsg);

          if (data.response) {
            appendMessage(data.response, "bot");
          } else {
            appendMessage("❌ Terjadi kesalahan: " + data.error, "bot");
          }
        } catch (err) {
          chatBody.removeChild(thinkingMsg);
          appendMessage("⚠️ Gagal terhubung ke server.", "bot");
        }
      }

      // Fungsi untuk mengupdate pesan bot secara animasi
      function appendMessage(text, sender) {
        const msg = document.createElement("div");
        msg.classList.add("message", sender);
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;

        // Replace newlines with <br> tags
        const formattedText = text.replace(/\n/g, '<br>');

        let i = 0;
        msg.innerText = ""; // Mulai dengan teks kosong

        // Fungsi untuk menambahkan karakter satu per satu
        function typeWriter() {
          if (i < text.length) {
            msg.textContent += text.charAt(i);
            i++;
            chatBody.scrollTop = chatBody.scrollHeight;
            setTimeout(typeWriter, 20); // Adjust kecepatan pengetikan di sini (50ms)
          } else {
            requestAnimationFrame(() => {
              chatBody.scrollTop = chatBody.scrollHeight;
            });
          }  
        }

        // Mulai efek pengetikan
        typeWriter();

        requestAnimationFrame(() => {
          chatBody.scrollTop = chatBody.scrollHeight;
        });

        return msg;
      }
      
      // Enter = kirim pesan
      promptInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendPrompt();
        }
      });
    </script>
{% endblock %}

