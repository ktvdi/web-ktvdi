{% extends 'base.html' %}

{% block content %}

<section class="relative bg-white pt-10 pb-20 overflow-hidden">
    <div class="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-brand-light rounded-full blur-3xl opacity-60 animate-float"></div>
    <div class="absolute bottom-[-10%] left-[-20%] w-[500px] h-[500px] bg-blue-50 rounded-full blur-3xl opacity-60"></div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="flex flex-col lg:flex-row items-center gap-16">
            
            <div class="flex-1 text-center lg:text-left">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-white border border-brand-primary/20 text-brand-primary text-xs font-bold rounded-full mb-8 shadow-sm">
                    <span class="flex h-2 w-2 relative">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-primary opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-brand-primary"></span>
                    </span>
                    Siap Menuju Piala Dunia 2026
                </div>

                <h1 class="text-4xl md:text-6xl font-extrabold text-brand-deep leading-tight mb-6">
                    Selamat Datang di <br>
                    <span class="bg-clip-text text-transparent bg-gradient-to-r from-brand-primary via-blue-400 to-brand-primary bg-[length:200%_auto] animate-shimmer">
                        Komunitas TV Digital
                    </span>
                </h1>

                <p class="text-slate-500 text-lg leading-relaxed mb-8 max-w-2xl mx-auto lg:mx-0">
                    Platform informasi No.1 untuk masyarakat Indonesia. Temukan frekuensi siaran, jadwal bola, dan solusi teknis agar TV Anda jernih tanpa iuran bulanan.
                </p>

                <div class="flex flex-wrap gap-4 justify-center lg:justify-start">
                    <a href="{{ url_for('daftar_siaran') }}" class="px-8 py-4 bg-brand-primary hover:bg-brand-deep text-white font-bold rounded-xl shadow-xl shadow-brand-primary/30 transition transform hover:-translate-y-1 flex items-center gap-2">
                        <i class="fa-solid fa-database"></i> Lihat Database
                    </a>
                    {% if not session.get('user') %}
                    <a href="{{ url_for('register') }}" class="px-8 py-4 bg-white border border-slate-200 text-slate-700 hover:border-brand-primary hover:text-brand-primary font-bold rounded-xl transition flex items-center gap-2">
                        <i class="fa-solid fa-user-plus"></i> Gabung Komunitas
                    </a>
                    {% else %}
                    <a href="{{ url_for('add_data') }}" class="px-8 py-4 bg-white border border-slate-200 text-slate-700 hover:border-brand-primary hover:text-brand-primary font-bold rounded-xl transition flex items-center gap-2">
                        <i class="fa-solid fa-plus-circle"></i> Tambah Data
                    </a>
                    {% endif %}
                </div>
            </div>

            <div class="flex-1 w-full max-w-lg">
                <div class="bg-white p-6 rounded-2xl shadow-2xl border border-slate-100 relative group hover:border-brand-primary/30 transition">
                    <div class="flex justify-between items-center mb-6 border-b border-slate-100 pb-4">
                        <h3 class="text-sm font-bold text-brand-deep flex items-center gap-2">
                            <i class="fa-solid fa-chart-simple text-brand-primary"></i> Statistik Wilayah
                        </h3>
                        <span class="text-[10px] bg-brand-light text-brand-primary px-2 py-1 rounded-full font-bold">Live Data</span>
                    </div>
                    <div class="h-[280px] w-full relative"> 
                        <canvas id="provinsiChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-20 bg-white border-t border-slate-100">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <span class="text-brand-primary font-bold tracking-wider text-sm">EDUKASI PUBLIK</span>
            <h2 class="text-3xl md:text-4xl font-extrabold text-brand-deep mt-2">Mengapa Harus Pindah ke TV Digital Sekarang?</h2>
            <p class="text-slate-500 mt-4 max-w-2xl mx-auto">Penjelasan lengkap persiapan menyambut Piala Dunia 2026 untuk masyarakat awam.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <div class="flex gap-4 items-start p-6 bg-slate-50 rounded-2xl border border-slate-100 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-brand-primary text-xl flex-shrink-0"><i class="fa-solid fa-tv"></i></div>
                <div>
                    <h3 class="font-bold text-lg text-brand-deep mb-2">(APA) Itu TV Digital?</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">Teknologi penyiaran terbaru yang menggantikan TV Analog (yang banyak "semut"-nya). TV Digital menghasilkan gambar bersih, suara jernih, dan teknologi canggih gratis selamanya.</p>
                </div>
            </div>

            <div class="flex gap-4 items-start p-6 bg-slate-50 rounded-2xl border border-slate-100 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-xl flex-shrink-0"><i class="fa-solid fa-users"></i></div>
                <div>
                    <h3 class="font-bold text-lg text-brand-deep mb-2">(SIAPA) Yang Harus Pindah?</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">Seluruh masyarakat Indonesia. Tidak peduli TV Anda tabung atau layar datar, jika belum ada DVB-T2, Anda wajib memasang alat tambahan bernama <strong>Set Top Box (STB)</strong>.</p>
                </div>
            </div>

            <div class="flex gap-4 items-start p-6 bg-brand-deep rounded-2xl shadow-xl transform md:scale-105 border border-slate-700 relative overflow-hidden group">
                <div class="absolute top-0 right-0 w-32 h-32 bg-brand-primary rounded-full filter blur-3xl opacity-20 -mr-10 -mt-10"></div>
                <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center text-brand-accent text-xl flex-shrink-0"><i class="fa-solid fa-futbol"></i></div>
                <div class="relative z-10">
                    <h3 class="font-bold text-lg text-white mb-2">(MENGAPA) Penting untuk Piala Dunia 2026?</h3>
                    <p class="text-slate-300 text-sm leading-relaxed">Piala Dunia 2026 akan disiarkan dalam format High Definition (HD). TV Analog lama tidak sanggup menampilkan bola dengan jelas (berbayang). Dengan TV Digital, Anda bisa melihat rumput dan pergerakan bola setajam menonton langsung di stadion.</p>
                </div>
            </div>

            <div class="flex gap-4 items-start p-6 bg-slate-50 rounded-2xl border border-slate-100 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center text-orange-600 text-xl flex-shrink-0"><i class="fa-solid fa-clock"></i></div>
                <div>
                    <h3 class="font-bold text-lg text-brand-deep mb-2">(KAPAN) Harus Pasang?</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">Sekarang juga! Pemerintah sudah mematikan sinyal analog (ASO) di hampir seluruh wilayah. Jangan tunggu nanti, pasang STB sekarang agar tidak ketinggalan berita dan hiburan.</p>
                </div>
            </div>

             <div class="flex gap-4 items-start p-6 bg-slate-50 rounded-2xl border border-slate-100 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-purple-600 text-xl flex-shrink-0"><i class="fa-solid fa-map-location-dot"></i></div>
                <div>
                    <h3 class="font-bold text-lg text-brand-deep mb-2">(DIMANA) Bisa Nonton?</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">Dimana saja selama ada sinyal UHF. Gunakan aplikasi/website ini untuk mengecek jangkauan pemancar (MUX) di daerah Anda agar arah antena tepat sasaran.</p>
                </div>
            </div>

             <div class="flex gap-4 items-start p-6 bg-slate-50 rounded-2xl border border-slate-100 hover:shadow-lg transition">
                <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-600 text-xl flex-shrink-0"><i class="fa-solid fa-wrench"></i></div>
                <div>
                    <h3 class="font-bold text-lg text-brand-deep mb-2">(BAGAIMANA) Caranya?</h3>
                    <p class="text-slate-600 text-sm leading-relaxed">1. Beli STB DVB-T2 bersertifikat Kominfo.<br>2. Hubungkan antena UHF ke STB.<br>3. Hubungkan STB ke TV (kabel RCA/HDMI).<br>4. Nyalakan dan pilih menu "Pencarian Otomatis".</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-12 bg-brand-deep text-white border-y border-slate-800 relative overflow-hidden">
    <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-5"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center divide-x divide-slate-800/50">
            <div>
                <div class="text-4xl font-extrabold text-brand-accent mb-1">{{ jumlah_wilayah_layanan }}</div>
                <div class="text-xs text-slate-400 font-bold uppercase tracking-wider">Wilayah Tercover</div>
            </div>
            <div>
                <div class="text-4xl font-extrabold text-brand-accent mb-1">{{ jumlah_penyelenggara_mux }}</div>
                <div class="text-xs text-slate-400 font-bold uppercase tracking-wider">MUX Aktif</div>
            </div>
            <div>
                <div class="text-4xl font-extrabold text-brand-accent mb-1">{{ jumlah_siaran }}</div>
                <div class="text-xs text-slate-400 font-bold uppercase tracking-wider">Total Channel</div>
            </div>
            <div>
                <div class="text-4xl font-extrabold text-brand-accent mb-1">{{ most_common_siaran_count }}</div>
                <div class="text-xs text-slate-400 font-bold uppercase tracking-wider">Kontribusi User</div>
            </div>
        </div>
    </div>
</section>

<section class="py-20 bg-slate-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-4">
            <div>
                <h2 class="text-3xl font-extrabold text-brand-deep flex items-center gap-3">
                    <span class="w-1.5 h-8 bg-brand-primary rounded-full"></span>
                    Live Streaming TV
                </h2>
                <p class="text-sm text-slate-500 mt-2 ml-5">Pantau kualitas siaran langsung dari perangkat Anda.</p>
            </div>
            <div class="flex gap-2">
                <span class="px-4 py-1.5 bg-white border border-slate-200 text-xs font-bold rounded-full text-slate-600 shadow-sm"><i class="fa-solid fa-gauge-high text-brand-primary mr-1"></i> Auto Quality</span>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
            <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-2xl transition-all duration-300 group border border-slate-100">
                <div class="relative aspect-video bg-black">
                    <video id="vid-ntv" class="w-full h-full object-contain" controls poster="https://source.unsplash.com/800x450/?news,studio"></video>
                    <div class="absolute top-3 left-3 flex gap-2">
                        <span class="bg-red-600/90 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1 shadow-sm">
                            <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span> LIVE
                        </span>
                    </div>
                    <div class="absolute bottom-3 right-3">
                        <span id="badge-ntv" class="bg-black/60 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded border border-white/20">FHD</span>
                    </div>
                </div>
                <div class="p-5">
                    <h3 class="font-bold text-slate-800 group-hover:text-brand-primary transition text-lg">Nusantara TV</h3>
                    <p class="text-xs text-slate-500 mt-1">Berita & Informasi Aktual</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-2xl transition-all duration-300 group border border-slate-100">
                <div class="relative aspect-video bg-black">
                    <video id="vid-matrix" class="w-full h-full object-contain" controls poster="https://source.unsplash.com/800x450/?soccer"></video>
                    <div class="absolute top-3 left-3 flex gap-2">
                        <span class="bg-red-600/90 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1 shadow-sm">
                            <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span> LIVE
                        </span>
                    </div>
                    <div class="absolute bottom-3 right-3">
                        <span id="badge-matrix" class="bg-black/60 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded border border-white/20">HD</span>
                    </div>
                </div>
                <div class="p-5">
                    <h3 class="font-bold text-slate-800 group-hover:text-brand-primary transition text-lg">Matrix TV</h3>
                    <p class="text-xs text-slate-500 mt-1">Olahraga & Hiburan</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-2xl transition-all duration-300 group border border-slate-100">
                <div class="relative aspect-video bg-black">
                    <video id="vid-bsatu" class="w-full h-full object-contain" controls poster="https://source.unsplash.com/800x450/?finance"></video>
                    <div class="absolute top-3 left-3 flex gap-2">
                        <span class="bg-red-600/90 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1 shadow-sm">
                            <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span> LIVE
                        </span>
                    </div>
                    <div class="absolute bottom-3 right-3">
                        <span id="badge-bsatu" class="bg-black/60 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded border border-white/20">SD</span>
                    </div>
                </div>
                <div class="p-5">
                    <h3 class="font-bold text-slate-800 group-hover:text-brand-primary transition text-lg">BTV</h3>
                    <p class="text-xs text-slate-500 mt-1">Ekonomi & Bisnis</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-2xl transition-all duration-300 group border border-slate-100">
                <div class="relative aspect-video bg-black">
                    <video id="vid-rtv" class="w-full h-full object-contain" controls poster="https://source.unsplash.com/800x450/?cartoon"></video>
                    <div class="absolute top-3 left-3 flex gap-2">
                        <span class="bg-red-600/90 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1 shadow-sm">
                            <span class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span> LIVE
                        </span>
                    </div>
                    <div class="absolute bottom-3 right-3">
                        <span id="badge-rtv" class="bg-black/60 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded border border-white/20">HD</span>
                    </div>
                </div>
                <div class="p-5">
                    <h3 class="font-bold text-slate-800 group-hover:text-brand-primary transition text-lg">RTV HD</h3>
                    <p class="text-xs text-slate-500 mt-1">Keluarga & Anak</p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 1. CHART JS
        const labels = JSON.parse('{{ chart_labels | safe }}');
        const dataValues = JSON.parse('{{ chart_data | safe }}');
        const ctx = document.getElementById('provinsiChart').getContext('2d');
        
        // Gradient Blue
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, '#2563eb');
        gradient.addColorStop(1, '#93c5fd');

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Wilayah Tercover',
                    data: dataValues,
                    backgroundColor: gradient,
                    borderRadius: 8,
                    barThickness: 20,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { borderDash: [4, 4], color: '#f1f5f9' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // 2. VIDEO STREAMS + AUTO DETECT RESOLUTION (No HLS Jargon)
        const streams = {
            'vid-ntv': { url: 'https://nusantaratv.siar.us/nusantaratv/live/playlist.m3u8', badge: 'badge-ntv' },
            'vid-matrix': { url: 'https://stream.matrixtv.id/hls/stream.m3u8', badge: 'badge-matrix' },
            'vid-bsatu': { url: 'https://beritasatu.secureswiftcontent.com/han/beritasatu/bsatu10008/srtoutput/manifest.m3u8', badge: 'badge-bsatu' },
            'vid-rtv': { url: 'https://rtvstream.rtv.co.id:4555/hls/rtv.m3u8', badge: 'badge-rtv' }
        };

        for (const [id, data] of Object.entries(streams)) {
            const video = document.getElementById(id);
            const badge = document.getElementById(data.badge);

            // Function update badge otomatis
            const updateBadge = () => {
                if(video.videoHeight > 0) {
                    let res = video.videoHeight;
                    let label = "SD";
                    if(res >= 1080) label = "FHD";
                    else if(res >= 720) label = "HD";
                    // Tampilkan label bersih tanpa angka jika user awam
                    badge.innerText = `${label} ${res}p`;
                }
            };

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(data.url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.addEventListener('loadedmetadata', updateBadge);
                    video.addEventListener('playing', updateBadge);
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = data.url;
                video.addEventListener('loadedmetadata', updateBadge);
            }
        }
    });
</script>

{% endblock %}
