{% extends 'base.html' %}

{% block content %}
<section class="relative bg-white pt-20 pb-28 overflow-hidden">
    <div class="absolute top-0 right-0 w-[800px] h-[800px] bg-brand-surface rounded-full blur-3xl opacity-60 -mr-20 -mt-20 z-0"></div>
    
    <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="flex flex-col lg:flex-row items-center gap-16">
            <div class="flex-1 text-center lg:text-left">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 text-brand-blue text-xs font-bold rounded-full mb-6 shadow-sm animate-fade-in-down">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    Revolusi Penyiaran Indonesia
                </div>
                
                <h1 class="text-4xl md:text-6xl font-extrabold text-brand-navy leading-tight mb-6 tracking-tight">
                    Selamat Datang di <br> 
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-blue via-white to-brand-blue bg-[length:200%_auto] animate-shimmer">
                        Komunitas TV Digital Indonesia
                    </span>
                </h1>
                
                <p class="text-slate-500 text-lg mb-8 max-w-2xl mx-auto lg:mx-0 leading-relaxed text-justify">
                    Sudah saatnya kita meninggalkan era analog yang penuh "semut" dan beralih ke siaran yang jernih, canggih, dan merata. KTVDI hadir sebagai jembatan informasi agar setiap keluarga Indonesia mendapatkan hak siaran yang jernih, canggih, dan gratis.
                </p>
                
                <div class="flex flex-wrap gap-4 justify-center lg:justify-start">
                    <a href="/daftar-siaran" class="px-8 py-4 bg-brand-blue text-white font-bold rounded-xl shadow-xl hover:bg-blue-700 transition flex items-center gap-2 transform hover:-translate-y-1">
                        <i class="fa-solid fa-tower-broadcast"></i> Cek Sinyal Digital
                    </a>
                    {% if not session.get('user') %}
                    <a href="/register" class="px-8 py-4 bg-white border border-slate-200 text-brand-navy font-bold rounded-xl hover:border-brand-blue hover:text-brand-blue transition flex items-center gap-2">
                        <i class="fa-solid fa-user-plus"></i> Gabung Komunitas
                    </a>
                    {% endif %}
                </div>
            </div>
            
            <div class="flex-1 w-full max-w-md">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 text-center hover:border-brand-blue transition group transform hover:-translate-y-1">
                        <div class="text-4xl font-extrabold text-brand-navy group-hover:text-brand-blue transition">{{ stats.wilayah }}</div>
                        <div class="text-xs text-slate-400 font-bold uppercase mt-1">Wilayah Terjangkau</div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 text-center hover:border-brand-blue transition group transform hover:-translate-y-1">
                        <div class="text-4xl font-extrabold text-brand-navy group-hover:text-brand-blue transition">{{ stats.mux }}</div>
                        <div class="text-xs text-slate-400 font-bold uppercase mt-1">MUX Beroperasi</div>
                    </div>
                    <div class="col-span-2 bg-brand-navy p-8 rounded-2xl shadow-xl text-center text-white relative overflow-hidden group transform hover:-translate-y-1">
                        <div class="absolute top-0 right-0 w-40 h-40 bg-brand-blue rounded-full blur-3xl opacity-20 group-hover:opacity-40 transition"></div>
                        <div class="relative z-10">
                            <div class="text-6xl font-extrabold text-brand-sky mb-2 group-hover:scale-110 transition duration-300">{{ stats.channel }}</div>
                            <div class="text-sm text-slate-300 font-bold uppercase tracking-widest">Total Channel Nasional</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-24 bg-slate-900 border-y border-slate-800 relative overflow-hidden">
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full max-w-3xl h-64 bg-brand-blue/10 blur-[100px] rounded-full"></div>

    <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="text-center mb-12">
            <span class="text-brand-sky font-bold text-xs uppercase tracking-[0.2em] bg-slate-800 px-4 py-1.5 rounded-full border border-slate-700">Official Stream</span>
            <h2 class="text-3xl md:text-4xl font-extrabold text-white mt-4 tracking-tight">Nonton TV Digital Online</h2>
            <p class="text-slate-400 mt-2">Streaming resmi saluran DVB-T2 Indonesia kualitas HD.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="tv-grid">
            </div>
    </div>
</section>

<section class="py-24 bg-white">
    <div class="max-w-7xl mx-auto px-4">
        <div class="text-center mb-16">
            <span class="text-brand-blue font-bold text-sm uppercase tracking-wider bg-blue-50 px-3 py-1 rounded-full">Pusat Pengetahuan</span>
            <h2 class="text-3xl font-extrabold text-brand-navy mt-4">Panduan Lengkap TV Digital</h2>
            <p class="text-slate-500 max-w-3xl mx-auto mt-3">
                Memahami teknologi DVB-T2 agar Anda mendapatkan siaran maksimal tanpa gangguan.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-start">
            <div class="space-y-8">
                <div class="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                    <h3 class="text-xl font-bold text-brand-navy mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-tower-cell text-brand-blue"></i> Apa itu MUX & Kanal?
                    </h3>
                    <p class="text-slate-600 text-sm leading-relaxed text-justify">
                        <strong>MUX (Multiplexing)</strong> adalah teknologi yang memungkinkan satu frekuensi memancarkan banyak saluran TV sekaligus. Ibarat "Bus", MUX adalah kendaraannya, dan channel TV (RCTI, SCTV, dll) adalah penumpangnya. 
                        <br><br>
                        Setiap wilayah memiliki kanal frekuensi yang berbeda. Misalnya, di Jakarta MUX TVRI ada di kanal 43 UHF (650 MHz). Anda harus mengarahkan antena ke pemancar MUX ini.
                    </p>
                </div>

                <div class="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                    <h3 class="text-xl font-bold text-brand-navy mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-wave-square text-brand-blue"></i> Frekuensi Emas 700 MHz
                    </h3>
                    <p class="text-slate-600 text-sm leading-relaxed text-justify">
                        TV Digital di Indonesia bekerja pada pita frekuensi <strong>UHF (Ultra High Frequency)</strong>, khususnya di sekitar <strong>700 MHz</strong>. Karakteristik frekuensi ini sangat istimewa:
                    </p>
                    <ul class="list-disc pl-5 mt-2 text-sm text-slate-600 space-y-1">
                        <li>Daya tembus yang kuat (bisa menembus tembok tebal).</li>
                        <li>Jangkauan luas (cocok untuk kontur geografis Indonesia).</li>
                        <li>Lebih tahan terhadap gangguan cuaca dibanding frekuensi tinggi.</li>
                    </ul>
                </div>
            </div>

            <div class="space-y-4">
                <details class="group bg-white p-5 rounded-2xl border border-slate-200 shadow-sm open:ring-2 open:ring-brand-blue/10 transition">
                    <summary class="flex justify-between items-center font-bold text-brand-navy cursor-pointer list-none text-lg">
                        Sinyal "Cekot-Cekot" atau Hilang?
                        <span class="transition group-open:rotate-180 text-brand-blue"><i class="fa-solid fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-slate-600 text-sm mt-4 text-justify leading-relaxed border-t border-slate-100 pt-4">
                        <p class="mb-2">Masalah ini 95% terjadi karena instalasi antena yang kurang optimal. TV Digital memiliki sifat <em>"Cliff Effect"</em>: Gambarnya bersih jernih, atau hilang sama sekali (tidak ada semut).</p>
                        <strong>Solusi Ampuh:</strong>
                        <ul class="list-disc pl-5 mt-1 space-y-1">
                            <li>Gunakan antena <strong>UHF Outdoor</strong> (jenis Yagi/Tulang Ikan).</li>
                            <li>Ganti kabel antena lama dengan kabel <strong>RG6</strong> berkualitas tinggi.</li>
                            <li>Pastikan <strong>Jack Konektor</strong> tidak berkarat dan terpasang kencang.</li>
                            <li>Hindari percabangan kabel (pararel) tanpa menggunakan splitter aktif.</li>
                        </ul>
                    </div>
                </details>

                <details class="group bg-white p-5 rounded-2xl border border-slate-200 shadow-sm open:ring-2 open:ring-brand-blue/10 transition">
                    <summary class="flex justify-between items-center font-bold text-brand-navy cursor-pointer list-none text-lg">
                        Apakah Perlu Berlangganan?
                        <span class="transition group-open:rotate-180 text-brand-blue"><i class="fa-solid fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-slate-600 text-sm mt-4 text-justify leading-relaxed border-t border-slate-100 pt-4">
                        <p><strong>TIDAK!</strong> Siaran TV Digital Terestrial (DVB-T2) adalah <strong>Free-To-Air (FTA)</strong> alias Gratis Selamanya. Ini adalah hak publik.</p>
                        <p class="mt-2">Anda tidak perlu kuota internet, tidak perlu piringan parabola, dan tidak ada iuran bulanan. Cukup modal antena UHF dan STB (jika TV belum digital).</p>
                    </div>
                </details>

                <div class="bg-brand-navy text-white p-8 rounded-2xl relative overflow-hidden shadow-2xl mt-6">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-brand-blue rounded-full blur-3xl opacity-20 -mr-10 -mt-10"></div>
                    <div class="relative z-10 text-center">
                        <h3 class="text-xl font-bold mb-2">Masih Ada Kendala?</h3>
                        <p class="text-sm text-slate-300 mb-6">
                            Tim teknis komunitas kami siap membantu mendiagnosa masalah sinyal di rumah Anda secara gratis.
                        </p>
                        <a href="https://www.instagram.com/ktvdi.id" target="_blank" class="inline-flex items-center justify-center gap-2 w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-3.5 rounded-xl transition shadow-lg transform hover:-translate-y-1">
                            <i class="fa-brands fa-instagram text-xl"></i> Konsultasi via DM Instagram
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* Animasi Shimmer untuk Teks Selamat Datang */
    @keyframes shimmer {
        0% { background-position: 200% center; }
        100% { background-position: -200% center; }
    }
    .animate-shimmer {
        animation: shimmer 3s linear infinite;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const channels = [
            {name: "RTV HD-2", url: "https://rtvstream.rtv.co.id:4555/hls/rtv.m3u8"},
            {name: "Matrix TV Jogja", url: "https://stream.matrixtv.id/hls/stream.m3u8"},
            {name: "Berita Satu", url: "https://beritasatu.secureswiftcontent.com/han/beritasatu/bsatu10008/srtoutput/manifest.m3u8"},
            {name: "Nusantara TV", url: "https://nusantaratv.siar.us/nusantaratv/live/playlist.m3u8"},
            {name: "Semarang TV", url: "http://36.94.24.229/0.m3u8"},
            {name: "Caruban TV", url: "https://stream.carubantv.id/hls/stream.m3u8"},
            {name: "Stara TV Malang", url: "https://malang.staratv.id/hls/stream.m3u8"},
            {name: "TVRI Nasional", url: "https://ott-balancer.tvri.go.id/live/eds/Nasional/hls/Nasional.m3u8"},
            {name: "Garuda TV", url: "https://hgmtv.com:19360/garudatvlivestreaming/garudatvlivestreaming.m3u8"},
            {name: "Kompas TV HD", url: "https://www.youtube.com/live/DOOrIxw5xOw?si=JXBIKaInzJ5og-4F", type: "youtube"},
            {name: "Rasika USA TV", url: "https://rasika.siar.us/live/rasika.m3u8"}
        ];

        const grid = document.getElementById('tv-grid');
        
        channels.forEach((ch, idx) => {
            const div = document.createElement('div');
            // Card Style: Dark Premium
            div.className = "bg-slate-800 rounded-2xl overflow-hidden border border-slate-700 hover:border-brand-blue/50 transition-all duration-300 group relative shadow-2xl";
            
            let playerContent = '';
            
            if (ch.type === "youtube") {
                // Youtube Embed
                playerContent = `<iframe src="https://www.youtube.com/embed/DOOrIxw5xOw?autoplay=0&mute=1" class="w-full h-full absolute inset-0" frameborder="0" allowfullscreen></iframe>`;
            } else {
                // HLS Player dengan Custom Loading
                playerContent = `
                    <div class="absolute inset-0 flex flex-col items-center justify-center bg-slate-900 z-20 loading-spinner transition-opacity duration-500">
                        <img src="{{ url_for('static', filename='images/ktvdi.png') }}" class="w-12 h-auto animate-pulse mb-3 brightness-200">
                        <i class="fa-solid fa-circle-notch fa-spin text-brand-blue text-xl"></i>
                    </div>
                    <video id="vid-${idx}" class="w-full h-full object-cover" controls playsinline muted></video>
                `;
            }

            div.innerHTML = `
                <div class="relative aspect-video bg-black group-hover:scale-[1.01] transition duration-500">
                    ${playerContent}
                    
                    ${ch.type !== 'youtube' ? `
                    <div class="absolute top-3 left-3 z-30 flex items-center gap-1.5 bg-red-600/90 backdrop-blur-sm text-white text-[10px] font-bold px-2.5 py-1 rounded-full shadow-lg border border-red-500 animate-pulse">
                        <span class="w-1.5 h-1.5 bg-white rounded-full"></span> LIVE
                    </div>` : ''}
                </div>
                
                <div class="p-4 bg-slate-800 border-t border-slate-700 flex items-center justify-between">
                    <div>
                        <h3 class="font-bold text-white text-sm truncate tracking-wide">${ch.name}</h3>
                        ${ch.type !== 'youtube' ? `
                        <div class="flex items-center gap-2 mt-1.5">
                            <div class="flex items-end gap-[2px] h-3">
                                <span class="w-0.5 bg-brand-blue h-full animate-[pulse_0.8s_ease-in-out_infinite]"></span>
                                <span class="w-0.5 bg-brand-blue h-2/3 animate-[pulse_1.2s_ease-in-out_infinite]"></span>
                                <span class="w-0.5 bg-brand-blue h-full animate-[pulse_1s_ease-in-out_infinite]"></span>
                            </div>
                            <span class="text-[10px] text-slate-400 font-medium tracking-wide">Sedang Memutar</span>
                        </div>` : 
                        '<span class="text-[10px] text-red-400 font-bold mt-1.5 flex items-center gap-1"><i class="fa-brands fa-youtube"></i> YouTube Live</span>'}
                    </div>
                </div>
            `;
            
            grid.appendChild(div);

            if (ch.type !== "youtube") {
                const video = document.getElementById(`vid-${idx}`);
                const spinner = div.querySelector('.loading-spinner');
                
                // Logic menghilangkan loading saat video siap
                video.addEventListener('canplay', () => { 
                    spinner.style.opacity = '0'; 
                    setTimeout(() => spinner.remove(), 500); 
                });
                
                // Munculkan loading lagi jika buffering
                video.addEventListener('waiting', () => { 
                    spinner.style.opacity = '1'; 
                });

                if(Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(ch.url);
                    hls.attachMedia(video);
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = ch.url;
                }
            }
        });
    });
</script>
{% endblock %}
