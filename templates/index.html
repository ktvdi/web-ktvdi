{% extends 'base.html' %}

{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    .font-youtube { font-family: 'Roboto', sans-serif; }
    .text-glossy-effect { background: linear-gradient(to right, #0f172a 0%, #2563eb 20%, #ffffff 50%, #2563eb 80%, #0f172a 100%); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: textShine 3s linear infinite; font-weight: 800; }
    @keyframes textShine { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
    @keyframes marqueeCard { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    .animate-marquee-card { display: inline-block; white-space: nowrap; animation: marqueeCard 30s linear infinite; padding-left: 100%; }
    
    /* Play Button Hover Effect */
    .play-btn-pulse { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7); animation: pulse-blue 2s infinite; }
    @keyframes pulse-blue { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(37, 99, 235, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); } }
</style>

<section class="relative bg-white pt-24 pb-20 overflow-hidden font-['Plus_Jakarta_Sans']">
    <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="flex flex-col lg:flex-row items-center gap-16">
            <div class="flex-1 text-center lg:text-left">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 text-brand-blue text-xs font-bold rounded-full mb-6 shadow-sm">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Revolusi Penyiaran Indonesia
                </div>
                <h1 class="text-4xl md:text-6xl font-extrabold text-brand-navy leading-tight mb-6 tracking-tight">
                    Selamat Datang di <br> <span class="text-glossy-effect">Komunitas TV Digital</span>
                </h1>
                <p class="text-slate-500 text-lg mb-8 max-w-2xl mx-auto lg:mx-0 leading-relaxed text-justify">
                    KTVDI adalah inisiatif independen untuk menjembatani masyarakat menuju era TV Digital. Kami menyediakan informasi akurat, panduan teknis, dan forum diskusi agar setiap keluarga Indonesia bisa menikmati siaran jernih, canggih, dan gratis tanpa biaya bulanan.
                </p>
                <div class="flex flex-wrap gap-4 justify-center lg:justify-start">
                    <a href="/daftar-siaran" class="px-8 py-4 bg-brand-blue text-white font-bold rounded-xl shadow-lg hover:bg-blue-700 transition flex items-center gap-2 transform hover:-translate-y-1">
                        <i class="fa-solid fa-tower-broadcast"></i> Cek Sinyal Digital
                    </a>
                    {% if not session.get('user') %}
                    <a href="/register" class="px-8 py-4 bg-white border border-slate-200 text-brand-navy font-bold rounded-xl hover:border-brand-blue hover:text-brand-blue transition flex items-center gap-2">
                        <i class="fa-solid fa-user-plus"></i> Gabung Komunitas
                    </a>
                    {% endif %}
                </div>
            </div>
            
            <div class="flex-1 w-full max-w-md">
                <div class="bg-white p-8 rounded-3xl shadow-2xl border border-slate-100 relative">
                    <div class="grid grid-cols-2 gap-6 text-center mb-8">
                        <div>
                            <div class="text-3xl font-extrabold text-brand-navy">{{ stats.wilayah if stats else 0 }}</div>
                            <div class="text-[10px] text-slate-400 font-bold uppercase mt-1 tracking-wider">Wilayah</div>
                        </div>
                        <div>
                            <div class="text-3xl font-extrabold text-brand-navy">{{ stats.mux if stats else 0 }}</div>
                            <div class="text-[10px] text-slate-400 font-bold uppercase mt-1 tracking-wider">MUX</div>
                        </div>
                    </div>
                    <div class="bg-brand-navy p-8 rounded-2xl text-center text-white relative overflow-hidden">
                        <div class="relative z-10">
                            <div class="text-6xl font-extrabold text-brand-sky">{{ stats.channel if stats else 0 }}</div>
                            <div class="text-xs text-slate-300 font-bold uppercase mt-2 tracking-[0.2em]">Total Channel</div>
                        </div>
                    </div>
                    <div class="text-center mt-6 text-[10px] text-slate-400">
                        Update Terakhir: <span class="font-bold text-brand-blue">{{ last_updated_time }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-20 border-y border-slate-800 relative overflow-hidden" style="background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);">
    <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="text-center mb-12">
            <span class="text-brand-sky font-bold text-[10px] uppercase tracking-[0.2em] bg-slate-800/80 px-3 py-1.5 rounded-full border border-slate-700 backdrop-blur-sm shadow-lg">Official Stream</span>
            <h2 class="text-3xl md:text-4xl font-extrabold text-white mt-4 tracking-tight font-youtube">Nonton Siaran Nasional</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="tv-grid"></div>
    </div>
</section>

<section class="py-24 bg-slate-50 border-b border-slate-200 font-['Plus_Jakarta_Sans']">
    <div class="max-w-6xl mx-auto px-4">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
            <div class="bg-white p-8 rounded-3xl shadow-lg border border-slate-100 flex flex-col items-center text-center gap-4 hover:-translate-y-2 transition duration-300 group">
                <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition"><i class="fa-solid fa-tv text-2xl"></i></div>
                <h3 class="text-xl font-bold text-brand-navy">1. Bersih Gambarnya</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Teknologi DVB-T2 menjamin gambar diterima jernih tanpa semut atau bayangan meskipun cuaca buruk.</p>
            </div>
            
            <div class="bg-white p-8 rounded-3xl shadow-lg border border-slate-100 flex flex-col items-center text-center gap-4 hover:-translate-y-2 transition duration-300 group">
                <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition"><i class="fa-solid fa-tower-cell text-2xl"></i></div>
                <h3 class="text-xl font-bold text-brand-navy">2. Canggih Teknologinya (MUX)</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Satu frekuensi bisa memuat hingga 12 channel TV (MUX), membuat spektrum frekuensi jauh lebih efisien.</p>
            </div>

            <div class="bg-white p-8 rounded-3xl shadow-lg border border-slate-100 flex flex-col items-center text-center gap-4 hover:-translate-y-2 transition duration-300 group">
                <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center text-green-600 group-hover:bg-green-600 group-hover:text-white transition"><i class="fa-solid fa-wallet text-2xl"></i></div>
                <h3 class="text-xl font-bold text-brand-navy">3. Gratis Selamanya</h3>
                <p class="text-slate-500 text-sm leading-relaxed">Bukan streaming internet, bukan langganan bulanan. Cukup beli STB DVB-T2 sekali, gratis selamanya.</p>
            </div>
        </div>

        <div class="space-y-6 max-w-4xl mx-auto">
            <h3 class="text-center text-2xl font-bold text-brand-navy mb-8">Paling Sering Ditanyakan</h3>
            
            <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition">
                <h4 class="font-bold text-brand-blue text-lg mb-2 flex items-center gap-2"><i class="fa-solid fa-trophy"></i> Cara Nonton Piala Dunia 2026?</h4>
                <p class="text-slate-600 text-sm leading-relaxed text-justify">
                    Hak siar resmi Piala Dunia 2026 dipegang oleh <strong>TVRI</strong> (TVRI Nasional & TVRI Sport). Anda bisa menonton seluruh pertandingan secara <strong>GRATIS</strong> dan kualitas <strong>HD</strong> melalui siaran TV Digital menggunakan antena UHF biasa. Tidak perlu berlangganan atau kuota internet. Pastikan arah antena Anda tepat ke pemancar TVRI terdekat.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-slate-800 mb-2">Panduan Pasang Antena</h4>
                    <ul class="text-slate-500 text-sm list-disc pl-4 space-y-1">
                        <li>Gunakan antena Outdoor untuk hasil maksimal.</li>
                        <li>Pakai kabel koaksial RG6 berkualitas.</li>
                        <li>Arahkan antena ke pemancar MUX terdekat.</li>
                        <li>Hindari halangan gedung/pohon tinggi.</li>
                    </ul>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-slate-800 mb-2">Cara Scan Ulang STB</h4>
                    <ol class="text-slate-500 text-sm list-decimal pl-4 space-y-1">
                        <li>Tekan tombol MENU di remote STB.</li>
                        <li>Pilih Pencarian Saluran (Search).</li>
                        <li>Pilih Pencarian Otomatis (Auto Scan).</li>
                        <li>Tunggu hingga 100% selesai.</li>
                    </ol>
                </div>
            </div>

            <details class="group bg-white p-4 rounded-xl border border-slate-200 cursor-pointer">
                <summary class="font-bold text-slate-700 flex justify-between items-center">Apa itu MUX? <span><i class="fa-solid fa-chevron-down text-brand-blue"></i></span></summary>
                <div class="mt-4 text-slate-500 text-sm leading-relaxed border-t pt-4 text-justify">
                    <strong>MUX (Multiplexing)</strong> adalah teknologi penggabungan beberapa saluran TV digital dalam satu paket frekuensi siaran. Contoh: Dalam satu kanal MUX TVRI (misal kanal 43 UHF), bisa terdapat TVRI Nasional, TVRI Sport, TVRI World, dan TV lokal lainnya. Ini membuat penggunaan frekuensi jauh lebih hemat.
                </div>
            </details>
        </div>

        <div class="bg-brand-navy rounded-3xl p-10 md:p-12 text-white relative overflow-hidden flex flex-col md:flex-row items-center justify-between gap-8 shadow-2xl mt-16">
            <div class="relative z-10 max-w-lg text-center md:text-left">
                <h2 class="text-2xl font-bold mb-3">Butuh Bantuan Lebih Lanjut?</h2>
                <p class="text-slate-300 leading-relaxed">Bergabunglah dengan ribuan anggota komunitas kami di grup diskusi untuk mendapatkan solusi teknis secara real-time.</p>
            </div>
            <a href="https://www.facebook.com/share/g/18CKU4FayC/" target="_blank" class="relative z-10 px-8 py-4 bg-white text-brand-navy font-bold rounded-xl hover:bg-slate-100 transition shadow-lg flex items-center gap-3 transform hover:scale-105">
                <i class="fa-brands fa-facebook text-xl"></i> Grup Facebook KTVDI
            </a>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const channels = [
            {name: "Caruban TV", url: "https://stream.carubantv.id/hls/stream.m3u8", logo: "https://iili.io/f8YnXh7.png"},
            {name: "Rasika USA TV", url: "https://rasika.siar.us/live/rasika.m3u8", logo: "https://rasika.siar.us/assets/img/logo.png"},
            {name: "Stara TV Malang", url: "https://malang.staratv.id/hls/stream.m3u8", logo: "https://iili.io/f8YVekl.md.png"},
            {name: "TVRI Nasional", url: "https://ott-balancer.tvri.go.id/live/eds/Nasional/hls/Nasional.m3u8", logo: "https://iili.io/f87NRoB.md.png"},
            {name: "RTV HD-2", url: "https://rtvstream.rtv.co.id:4555/hls/rtv.m3u8", logo: "https://iili.io/f876F44.md.png"},
            {name: "KompasTV HD", url: "https://www.youtube.com/embed/live_stream?channel=UC7tV3Qv0K6z7q9Z7X1x9x9g", type: "youtube", logo: "https://iili.io/f8YFc1R.jpg"},
            {name: "Garuda TV", url: "https://hgmtv.com:19360/garudatvlivestreaming/garudatvlivestreaming.m3u8", logo: "https://iili.io/f8Y7QV4.png"},
            {name: "Nusantara TV", url: "https://nusantaratv.siar.us/nusantaratv/live/playlist.m3u8", logo: "https://iili.io/f8YIZPt.jpg"},
            {name: "Berita Satu", url: "https://beritasatu.secureswiftcontent.com/han/beritasatu/bsatu10008/srtoutput/manifest.m3u8", logo: "https://iili.io/f878bP2.jpg"},
            {name: "Matrix TV Yogyakarta", url: "https://stream.matrixtv.id/hls/stream.m3u8", logo: "https://iili.io/f87LXWX.md.png"},
            {name: "Semarang TV", url: "http://116.254.112.74:80/hls/cakralive.m3u8", logo: "https://iili.io/f87yF6P.png"}
        ];

        const grid = document.getElementById('tv-grid');
        
        channels.forEach((ch, idx) => {
            const div = document.createElement('div');
            div.className = "bg-transparent group";
            
            let playerHtml = '';
            
            if (ch.type === "youtube") {
                playerHtml = `
                    <iframe src="https://www.youtube.com/embed/DOOrIxw5xOw?autoplay=0&mute=0&controls=1" 
                        class="w-full h-full absolute inset-0 object-cover rounded-t-xl" 
                        frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
                    </iframe>`;
            } else {
                playerHtml = `
                    <div class="absolute inset-0 z-20 flex items-center justify-center bg-black/40 cursor-pointer group-video-placeholder group-hover:bg-black/20 transition" onclick="loadHLS(this, '${ch.url}', 'vid-${idx}')">
                        <div class="w-16 h-16 rounded-full bg-brand-blue/90 backdrop-blur-md flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform ring-4 ring-white/10 play-btn-pulse">
                            <i class="fa-solid fa-play text-white text-2xl ml-1"></i>
                        </div>
                    </div>
                    <div class="loading-spinner absolute inset-0 flex flex-col items-center justify-center bg-[#0f0f0f] z-10 hidden rounded-t-xl">
                        <i class="fa-solid fa-circle-notch fa-spin text-white text-3xl"></i>
                    </div>
                    <video id="vid-${idx}" class="w-full h-full object-cover rounded-t-xl" muted playsinline></video>
                    
                    <div class="absolute bottom-0 left-0 right-0 p-3 flex justify-between items-end opacity-0 group-hover:opacity-100 transition-opacity z-30 bg-gradient-to-t from-black/80 to-transparent rounded-t-xl pointer-events-none">
                        <div class="flex gap-2 pointer-events-auto">
                            <button onclick="toggleMute('vid-${idx}', this)" class="text-white hover:text-brand-blue"><i class="fa-solid fa-volume-high"></i></button>
                            <button onclick="stopVideo('vid-${idx}')" class="text-white hover:text-red-500"><i class="fa-solid fa-stop"></i></button>
                            <button onclick="reloadVideo('vid-${idx}', '${ch.url}')" class="text-white hover:text-green-500"><i class="fa-solid fa-rotate-right"></i></button>
                        </div>
                        <button onclick="toggleFullScreen('vid-${idx}')" class="text-white hover:text-brand-blue pointer-events-auto"><i class="fa-solid fa-expand"></i></button>
                    </div>
                `;
            }

            div.innerHTML = `
                <div class="relative aspect-video bg-[#1e293b] rounded-t-xl overflow-hidden shadow-lg border border-white/5 group">
                    ${playerHtml}
                </div>
                
                <div class="bg-blue-900/50 backdrop-blur-sm border-t border-b border-white/10 h-7 flex items-center overflow-hidden relative">
                    <div class="absolute left-0 bg-blue-700 h-full px-2 flex items-center z-10 shadow-md">
                        <span class="text-[9px] font-bold text-white tracking-wider">INFO</span>
                    </div>
                    <div class="w-full h-full flex items-center">
                        <div class="animate-marquee-card text-[10px] text-blue-100 font-medium pl-4">
                            Saksikan siaran ${ch.name} kualitas HD di TV Digital. Kami bangga memperkenalkan siaran TV Digital ke kalangan Gen Z agar melek teknologi. Gratis selamanya tanpa kuota internet!
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-3 bg-[#0f172a] rounded-b-xl p-4 border-x border-b border-white/5">
                    <img src="${ch.logo}" class="w-9 h-9 rounded-full bg-white p-0.5 object-contain border border-slate-600" onerror="this.src='{{ url_for('static', filename='icons/icon-192.png') }}'">
                    <div>
                        <h3 class="text-white text-sm font-bold font-youtube leading-tight">${ch.name}</h3>
                        <div class="text-[10px] text-gray-400 font-youtube flex items-center gap-1.5 mt-0.5">
                            <span class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></span> LIVE
                        </div>
                    </div>
                </div>
            `;
            grid.appendChild(div);
        });
    });

    function loadHLS(placeholder, url, vidId) {
        const video = document.getElementById(vidId);
        const spinner = placeholder.nextElementSibling;
        placeholder.style.display = 'none';
        spinner.classList.remove('hidden');

        if(Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play();
                spinner.classList.add('hidden');
            });
            window['hls_'+vidId] = hls; // Store instance
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.addEventListener('loadedmetadata', () => {
                video.play();
                spinner.classList.add('hidden');
            });
        }
        video.muted = false;
    }

    function toggleMute(id, btn) {
        const v = document.getElementById(id);
        v.muted = !v.muted;
        btn.innerHTML = v.muted ? '<i class="fa-solid fa-volume-xmark"></i>' : '<i class="fa-solid fa-volume-high"></i>';
    }

    function stopVideo(id) {
        const v = document.getElementById(id);
        v.pause();
        // Show placeholder again logic (Simplified: Just pause)
    }

    function reloadVideo(id, url) {
        const v = document.getElementById(id);
        v.pause();
        if(window['hls_'+id]) {
            window['hls_'+id].loadSource(url);
            window['hls_'+id].attachMedia(v);
            v.play();
        }
    }

    function toggleFullScreen(id) {
        const v = document.getElementById(id);
        if (v.requestFullscreen) v.requestFullscreen();
    }
</script>
{% endblock %}
