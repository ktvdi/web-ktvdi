{% extends 'base.html' %}

{% block content %}

<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    .font-youtube { font-family: 'Roboto', sans-serif; }

    @keyframes textShine { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
    .text-glossy-effect {
        background: linear-gradient(to right, #0f172a 0%, #2563eb 20%, #ffffff 50%, #2563eb 80%, #0f172a 100%);
        background-size: 200% auto;
        color: #0f172a;
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: textShine 3s linear infinite;
        font-weight: 800;
        display: inline-block;
    }
    @keyframes marqueeCard { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    .animate-marquee-card { display: inline-block; white-space: nowrap; animation: marqueeCard 30s linear infinite; padding-left: 100%; }
</style>

<section class="relative bg-white pt-20 pb-28 overflow-hidden font-['Plus_Jakarta_Sans']">
    <div class="absolute top-0 right-0 w-[800px] h-[800px] bg-brand-surface rounded-full blur-3xl opacity-60 -mr-20 -mt-20 z-0"></div>
    <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="flex flex-col lg:flex-row items-center gap-16">
            <div class="flex-1 text-center lg:text-left">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 text-brand-blue text-xs font-bold rounded-full mb-6 shadow-sm animate-pulse">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span> Revolusi Penyiaran Indonesia
                </div>
                <h1 class="text-4xl md:text-6xl font-extrabold text-brand-navy leading-tight mb-6 tracking-tight">
                    Selamat Datang di <br> <span class="text-glossy-effect pb-2">Komunitas TV Digital Indonesia</span>
                </h1>
                <p class="text-slate-500 text-lg mb-8 max-w-2xl mx-auto lg:mx-0 leading-relaxed text-justify">
                    Sudah saatnya kita meninggalkan era analog yang penuh "semut". KTVDI hadir sebagai jembatan informasi agar setiap keluarga Indonesia mendapatkan hak siaran yang jernih, canggih, dan gratis.
                </p>
                <div class="flex flex-wrap gap-4 justify-center lg:justify-start">
                    <a href="/daftar-siaran" class="px-8 py-4 bg-brand-blue text-white font-bold rounded-xl shadow-xl hover:bg-blue-700 transition flex items-center gap-2 transform hover:-translate-y-1">
                        <i class="fa-solid fa-tower-broadcast"></i> Cek Sinyal Digital
                    </a>
                    {% if not session.get('user') %}
                    <a href="/register" class="px-8 py-4 bg-white border border-slate-200 text-brand-navy font-bold rounded-xl hover:border-brand-blue hover:text-brand-blue transition flex items-center gap-2">
                        <i class="fa-solid fa-user-plus"></i> Gabung Komunitas
                    </a>
                    {% endif %}
                </div>
            </div>
            
            <div class="flex-1 w-full max-w-md">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 text-center hover:border-brand-blue transition group">
                        <div class="text-4xl font-extrabold text-brand-navy group-hover:text-brand-blue">{{ stats.wilayah }}</div>
                        <div class="text-xs text-slate-400 font-bold uppercase mt-1">Wilayah</div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 text-center hover:border-brand-blue transition group">
                        <div class="text-4xl font-extrabold text-brand-navy group-hover:text-brand-blue">{{ stats.mux }}</div>
                        <div class="text-xs text-slate-400 font-bold uppercase mt-1">MUX</div>
                    </div>
                    <div class="col-span-2 bg-brand-navy p-8 rounded-2xl shadow-xl text-center text-white relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-40 h-40 bg-brand-blue rounded-full blur-3xl opacity-20"></div>
                        <div class="relative z-10">
                            <div class="text-6xl font-extrabold text-brand-sky mb-2">{{ stats.channel }}</div>
                            <div class="text-sm text-slate-300 font-bold uppercase tracking-widest">Total Channel Nasional</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-20 border-y border-slate-800 relative overflow-hidden" style="background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);">
    
    <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="text-center mb-16">
            <span class="text-brand-sky font-bold text-[10px] uppercase tracking-[0.2em] bg-slate-800/80 px-3 py-1.5 rounded-full border border-slate-700 backdrop-blur-sm shadow-lg">Official Stream</span>
            <h2 class="text-3xl md:text-4xl font-extrabold text-white mt-6 tracking-tight font-youtube">Nonton Siaran TV Nasional</h2>
            <p class="text-gray-400 mt-3 max-w-2xl mx-auto font-youtube text-sm">Streaming saluran TV Nasional pilihan kualitas HD, gratis di mana saja.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-12" id="tv-grid">
            </div>
    </div>
</section>

<section class="py-24 bg-white font-['Plus_Jakarta_Sans']">
    <div class="max-w-6xl mx-auto px-4">
        <div class="text-center mb-20">
            <h2 class="text-4xl font-extrabold text-brand-navy mb-6">Kenapa Harus TV Digital?</h2>
            <p class="text-slate-500 text-lg max-w-3xl mx-auto leading-relaxed">
                Dulu, nonton TV itu identik dengan gambar "semut" dan suara kresek-kresek. Kini, TV Digital hadir membawa revolusi kualitas gambar yang bening (High Definition) dan teknologi canggih—semuanya Gratis tanpa biaya bulanan.
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-start">
            <div class="lg:col-span-7 space-y-12">
                <div class="flex gap-5 group">
                    <div class="flex-shrink-0 w-14 h-14 rounded-2xl bg-blue-100 flex items-center justify-center text-brand-blue shadow-md group-hover:scale-110 transition-transform"><i class="fa-solid fa-tv text-2xl"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-brand-navy mb-3">1. Bersih Gambarnya, Jernih Suaranya</h3>
                        <p class="text-slate-600 leading-relaxed text-justify">
                            Teknologi DVB-T2 menjamin kualitas siaran yang diterima di rumah Anda sama persis dengan yang dipancarkan stasiun TV. Tidak ada lagi bintik semut atau bayangan hantu meskipun cuaca buruk.
                        </p>
                    </div>
                </div>
                
                <div class="flex gap-5 group">
                    <div class="flex-shrink-0 w-14 h-14 rounded-2xl bg-purple-100 flex items-center justify-center text-purple-600 shadow-md group-hover:scale-110 transition-transform"><i class="fa-solid fa-tower-cell text-2xl"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-brand-navy mb-3">2. Satu Frekuensi, Banyak Channel (MUX)</h3>
                        <p class="text-slate-600 leading-relaxed text-justify">
                            Sistem <strong>Multiplexing (MUX)</strong> ibarat "Bus Sekolah". Satu frekuensi kanal kini bisa mengangkut 6 hingga 12 stasiun TV sekaligus. Ini membuat penggunaan spektrum frekuensi jauh lebih efisien dan kita mendapatkan lebih banyak variasi tontonan.
                        </p>
                    </div>
                </div>

                <div class="flex gap-5 group">
                    <div class="flex-shrink-0 w-14 h-14 rounded-2xl bg-green-100 flex items-center justify-center text-green-600 shadow-md group-hover:scale-110 transition-transform"><i class="fa-solid fa-wallet text-2xl"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-brand-navy mb-3">3. Gratis Selamanya</h3>
                        <p class="text-slate-600 leading-relaxed text-justify">
                            Jangan salah sangka, TV Digital <strong>BUKAN streaming</strong> internet dan <strong>BUKAN TV kabel berlangganan</strong>. Anda hanya perlu membeli perangkat STB (Set Top Box) sekali saja seharga mulai Rp 150.000, dan setelah itu gratis selamanya tanpa kuota data.
                        </p>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5 space-y-6">
                <h3 class="text-lg font-bold text-slate-400 uppercase tracking-wider mb-2">Pertanyaan Populer</h3>
                
                <details class="group bg-white p-5 rounded-2xl border border-slate-200 shadow-sm open:shadow-md transition-all duration-300">
                    <summary class="flex justify-between items-center font-bold text-brand-navy cursor-pointer list-none select-none">
                        Sinyal Saya "Cekot-Cekot", Kenapa?
                        <span class="transition-transform duration-300 group-open:rotate-180 text-brand-blue"><i class="fa-solid fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-slate-600 text-sm mt-4 text-justify leading-relaxed border-t border-slate-100 pt-4">
                        <p>Masalah ini 95% disebabkan oleh instalasi antena yang kurang optimal. <strong>Solusi:</strong> Gunakan antena Outdoor (Luar), ganti kabel lama dengan kabel kualitas tinggi (RG6), dan pastikan jack konektor tidak berkarat.</p>
                    </div>
                </details>

                <details class="group bg-white p-5 rounded-2xl border border-slate-200 shadow-sm open:shadow-md transition-all duration-300">
                    <summary class="flex justify-between items-center font-bold text-brand-navy cursor-pointer list-none select-none">
                        Apakah TV Tabung Bisa Digital?
                        <span class="transition-transform duration-300 group-open:rotate-180 text-brand-blue"><i class="fa-solid fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-slate-600 text-sm mt-4 text-justify leading-relaxed border-t border-slate-100 pt-4">
                        <p><strong>Bisa Banget!</strong> Anda tidak perlu membeli TV baru. Cukup tambahkan alat bernama <strong>Set Top Box (STB) DVB-T2</strong> yang dipasang antara antena dan TV Tabung Anda menggunakan kabel RCA (Merah-Kuning-Putih).</p>
                    </div>
                </details>

                <details class="group bg-white p-5 rounded-2xl border border-slate-200 shadow-sm open:shadow-md transition-all duration-300">
                    <summary class="flex justify-between items-center font-bold text-brand-navy cursor-pointer list-none select-none">
                        Cara Nonton Piala Dunia 2026?
                        <span class="transition-transform duration-300 group-open:rotate-180 text-brand-blue"><i class="fa-solid fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-slate-600 text-sm mt-4 text-justify leading-relaxed border-t border-slate-100 pt-4">
                        <p>Hak siar Free-To-Air (UHF) biasanya dipegang oleh grup media besar (seperti EMTEK atau MNC). Pastikan antena Anda mengarah ke pemancar MUX grup tersebut untuk menikmati siaran HD gratis tanpa diacak.</p>
                    </div>
                </details>
                
                <div class="mt-8 pt-4">
                    <div class="bg-gradient-to-br from-brand-navy to-slate-800 text-white p-6 rounded-2xl relative overflow-hidden shadow-xl">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full blur-2xl -mr-10 -mt-10"></div>
                        <h4 class="font-bold text-lg mb-2 relative z-10">Masih Bingung?</h4>
                        <p class="text-sm text-slate-300 mb-4 relative z-10">Gabung grup diskusi kami untuk bantuan teknis.</p>
                        <a href="https://www.facebook.com/share/g/18CKU4FayC/" target="_blank" class="flex items-center justify-center gap-2 w-full bg-white text-brand-navy font-bold py-3 rounded-xl hover:bg-slate-100 transition relative z-10">
                            <i class="fa-brands fa-facebook"></i> Grup Facebook KTVDI
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const channels = [
            {name: "RTV HD-2", url: "https://rtvstream.rtv.co.id:4555/hls/rtv.m3u8", logo: "https://iili.io/f876F44.md.png"},
            {name: "Matrix TV Jogja", url: "https://stream.matrixtv.id/hls/stream.m3u8", logo: "https://iili.io/f87LXWX.md.png"},
            {name: "Berita Satu", url: "https://beritasatu.secureswiftcontent.com/han/beritasatu/bsatu10008/srtoutput/manifest.m3u8", logo: "https://iili.io/f878bP2.jpg"},
            {name: "Nusantara TV", url: "https://nusantaratv.siar.us/nusantaratv/live/playlist.m3u8", logo: "https://iili.io/f8YIZPt.jpg"},
            {name: "Semarang TV", url: "http://36.94.24.229/0.m3u8", logo: "https://iili.io/f87yF6P.png"},
            {name: "Caruban TV", url: "https://stream.carubantv.id/hls/stream.m3u8", logo: "https://iili.io/f8YnXh7.png"},
            {name: "Stara TV Malang", url: "https://malang.staratv.id/hls/stream.m3u8", logo: "https://iili.io/f8YVekl.md.png"},
            {name: "TVRI Nasional", url: "https://ott-balancer.tvri.go.id/live/eds/Nasional/hls/Nasional.m3u8", logo: "https://iili.io/f87NRoB.md.png"},
            {name: "Garuda TV", url: "https://hgmtv.com:19360/garudatvlivestreaming/garudatvlivestreaming.m3u8", logo: "https://iili.io/f8Y7QV4.png"},
            {name: "Kompas TV HD", url: "https://www.youtube.com/live/DOOrIxw5xOw?si=JXBIKaInzJ5og-4F", type: "youtube", logo: "https://iili.io/f8YFc1R.jpg"},
            {name: "Rasika USA TV", url: "https://rasika.siar.us/live/rasika.m3u8", logo: "https://rasika.siar.us/assets/img/logo.png"}
        ];

        const grid = document.getElementById('tv-grid');
        
        channels.forEach((ch, idx) => {
            const div = document.createElement('div');
            div.className = "bg-transparent group mb-6";
            
            let playerContent = '';
            
            // Player Logic: Click to Play (Hemat Resource)
            // Awalnya menampilkan tombol PLAY dan loading spinner hidden
            
            if (ch.type === "youtube") {
                playerContent = `
                    <div class="absolute inset-0 z-20 flex items-center justify-center bg-black cursor-pointer group-video-placeholder" onclick="loadYoutube(this, '${ch.url}')">
                        <div class="w-16 h-16 rounded-full bg-red-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <i class="fa-solid fa-play text-white text-2xl ml-1"></i>
                        </div>
                    </div>
                `;
            } else {
                playerContent = `
                    <div class="absolute inset-0 z-20 flex items-center justify-center bg-black cursor-pointer group-video-placeholder" onclick="loadHLS(this, '${ch.url}', 'vid-${idx}')">
                        <div class="w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <i class="fa-solid fa-play text-white text-2xl ml-1"></i>
                        </div>
                    </div>
                    
                    <div class="loading-spinner absolute inset-0 flex flex-col items-center justify-center bg-[#0f0f0f] z-10 transition-opacity duration-500 rounded-t-xl hidden">
                        <img src="{{ url_for('static', filename='icons/icon-192.png') }}" class="w-10 h-auto animate-bounce mb-2 brightness-150">
                        <span class="text-[10px] text-gray-500 font-bold tracking-widest uppercase">Memuat...</span>
                    </div>
                    
                    <video id="vid-${idx}" class="w-full h-full object-cover rounded-t-xl" muted playsinline></video>

                    <div class="absolute inset-0 z-10 flex flex-col justify-end p-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
                        <div class="flex justify-between items-end">
                            <button onclick="unmuteVideo('vid-${idx}', this)" class="group-video-unmute hidden pointer-events-auto bg-black/50 hover:bg-brand-blue text-white w-8 h-8 rounded-full backdrop-blur-md transition flex items-center justify-center border border-white/10" title="Bunyikan Suara">
                                <i class="fa-solid fa-volume-high text-xs"></i>
                            </button>
                            <button onclick="toggleFullScreen('vid-${idx}')" class="bg-black/50 hover:bg-brand-blue text-white w-8 h-8 rounded-full backdrop-blur-md pointer-events-auto transition flex items-center justify-center border border-white/10" title="Fullscreen">
                                <i class="fa-solid fa-expand text-xs"></i>
                            </button>
                        </div>
                    </div>
                `;
            }

            div.innerHTML = `
                <div class="relative aspect-video bg-[#1e293b] rounded-t-xl overflow-hidden shadow-2xl group-hover:shadow-[0_0_20px_rgba(37,99,235,0.3)] transition-shadow duration-300 border border-white/5">
                    ${playerContent}
                </div>

                <div class="bg-blue-900/50 backdrop-blur-sm border-t border-b border-white/10 h-6 flex items-center overflow-hidden relative">
                    <div class="absolute left-0 bg-blue-700 h-full px-2 flex items-center z-10 shadow-md">
                        <span class="text-[9px] font-bold text-white tracking-wider">INFO</span>
                    </div>
                    <div class="w-full h-full flex items-center">
                        <div class="animate-marquee-card text-[9px] text-blue-100 font-medium pl-4">
                            Tayangan LIVE Siaran TV di Website KTVDI ini kami tampilkan hanya pilihan, kami mengambil source dari website masing masing TV, bukan dari penyedia OTT dan dengan tujuan untuk memperkenalkan Siaran TV Digital ke kalangan Gen Z. Terima kasih.
                        </div>
                    </div>
                </div>
                
                <div class="pt-3 flex gap-3 bg-[#0f172a] rounded-b-xl px-4 pb-4 border-x border-b border-white/5">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 rounded-full bg-black flex items-center justify-center border border-slate-700 overflow-hidden p-0.5">
                            <img src="${ch.logo}" class="w-full h-full object-contain rounded-full" onerror="this.src='{{ url_for('static', filename='icons/icon-192.png') }}'">
                        </div>
                    </div>

                    <div class="flex-1">
                        <h3 class="text-white text-base font-bold font-youtube leading-tight mb-1 group-hover:text-brand-blue transition-colors line-clamp-1">${ch.name}</h3>
                        
                        <div class="flex flex-wrap items-center gap-2 text-[11px] text-gray-400 font-youtube font-medium">
                            <span class="text-red-500 font-bold flex items-center gap-1.5 bg-red-500/10 px-2 py-0.5 rounded border border-red-500/20">
                                <span class="relative flex h-1.5 w-1.5">
                                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-red-500"></span>
                                </span>
                                LIVE
                            </span>
                            <span>• Indonesia</span>
                        </div>
                    </div>
                </div>
            `;
            
            grid.appendChild(div);
        });
    });

    // --- FUNGSI PLAYER (KLIK UNTUK PLAY) ---
    
    function loadHLS(placeholder, url, vidId) {
        const video = document.getElementById(vidId);
        const spinner = placeholder.nextElementSibling; // Loading div
        const unmuteBtn = video.nextElementSibling.querySelector('.group-video-unmute');

        placeholder.style.display = 'none'; // Sembunyikan tombol play besar
        spinner.classList.remove('hidden'); // Tampilkan loading

        if(Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play();
                spinner.classList.add('hidden');
                unmuteBtn.classList.remove('hidden');
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.addEventListener('loadedmetadata', () => {
                video.play();
                spinner.classList.add('hidden');
                unmuteBtn.classList.remove('hidden');
            });
        }
        
        video.muted = true; // Auto play biasanya butuh muted dulu
    }

    function loadYoutube(placeholder, url) {
        // Ambil Video ID dari URL
        let vidId = "";
        if(url.includes("youtube.com/live/")) {
            vidId = url.split("/live/")[1].split("?")[0];
        } else if (url.includes("embed")) {
            vidId = url.split("embed/")[1].split("?")[0];
        }

        const iframe = document.createElement('iframe');
        iframe.src = `https://www.youtube.com/embed/${vidId}?autoplay=1&mute=0&controls=1`;
        iframe.className = "w-full h-full absolute inset-0 rounded-t-xl";
        iframe.frameBorder = "0";
        iframe.allow = "autoplay; encrypted-media; picture-in-picture";
        iframe.allowFullscreen = true;

        const parent = placeholder.parentNode;
        placeholder.style.display = 'none';
        parent.appendChild(iframe);
    }

    function unmuteVideo(id, btn) {
        const v = document.getElementById(id);
        if(v) {
            v.muted = false;
            v.volume = 1.0;
            btn.classList.add('hidden'); // Sembunyikan tombol unmute setelah diklik
        }
    }

    function toggleFullScreen(id) {
        const v = document.getElementById(id);
        if (v.requestFullscreen) v.requestFullscreen();
        else if (v.webkitEnterFullscreen) v.webkitEnterFullscreen();
    }
</script>
{% endblock %}
