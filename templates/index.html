{% extends 'base.html' %}

{% block content %}

<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    .font-youtube { font-family: 'Roboto', sans-serif; }

    @keyframes textShine {
        0% { background-position: 0% 50%; }
        100% { background-position: 200% 50%; }
    }
    .text-glossy-effect {
        background: linear-gradient(to right, #0f172a 0%, #2563eb 20%, #ffffff 50%, #2563eb 80%, #0f172a 100%);
        background-size: 200% auto;
        color: #0f172a;
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: textShine 3s linear infinite;
        font-weight: 800;
        display: inline-block;
    }
    
    /* Animasi Wave Audio */
    @keyframes wave {
        0%, 100% { height: 4px; }
        50% { height: 12px; }
    }

    /* Marquee Khusus Card TV */
    @keyframes marqueeCard {
        0% { transform: translateX(0); }
        100% { transform: translateX(-100%); }
    }
    .animate-marquee-card {
        display: inline-block;
        white-space: nowrap;
        animation: marqueeCard 25s linear infinite;
        padding-left: 100%;
    }
</style>

<section class="relative bg-white pt-20 pb-28 overflow-hidden font-['Plus_Jakarta_Sans']">
    <div class="absolute top-0 right-0 w-[800px] h-[800px] bg-brand-surface rounded-full blur-3xl opacity-60 -mr-20 -mt-20 z-0"></div>
    <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="flex flex-col lg:flex-row items-center gap-16">
            <div class="flex-1 text-center lg:text-left">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 text-brand-blue text-xs font-bold rounded-full mb-6 shadow-sm animate-pulse">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    Revolusi Penyiaran Indonesia
                </div>
                <h1 class="text-4xl md:text-6xl font-extrabold text-brand-navy leading-tight mb-6 tracking-tight">
                    Selamat Datang di <br> 
                    <span class="text-glossy-effect pb-2">Komunitas TV Digital Indonesia</span>
                </h1>
                <p class="text-slate-500 text-lg mb-8 max-w-2xl mx-auto lg:mx-0 leading-relaxed text-justify">
                    Sudah saatnya kita meninggalkan era analog yang penuh "semut" dan beralih ke siaran yang jernih, canggih, dan merata. KTVDI hadir sebagai jembatan informasi agar setiap keluarga Indonesia mendapatkan hak siaran yang jernih, canggih, dan gratis.
                </p>
                <div class="flex flex-wrap gap-4 justify-center lg:justify-start">
                    <a href="/daftar-siaran" class="px-8 py-4 bg-brand-blue text-white font-bold rounded-xl shadow-xl hover:bg-blue-700 transition flex items-center gap-2 transform hover:-translate-y-1">
                        <i class="fa-solid fa-tower-broadcast"></i> Cek Sinyal Digital
                    </a>
                    {% if not session.get('user') %}
                    <a href="/register" class="px-8 py-4 bg-white border border-slate-200 text-brand-navy font-bold rounded-xl hover:border-brand-blue hover:text-brand-blue transition flex items-center gap-2">
                        <i class="fa-solid fa-user-plus"></i> Gabung Komunitas
                    </a>
                    {% endif %}
                </div>
            </div>
            
            <div class="flex-1 w-full max-w-md">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 text-center hover:border-brand-blue transition group transform hover:-translate-y-1">
                        <div class="text-4xl font-extrabold text-brand-navy group-hover:text-brand-blue transition">{{ stats.wilayah }}</div>
                        <div class="text-xs text-slate-400 font-bold uppercase mt-1">Wilayah Terjangkau</div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 text-center hover:border-brand-blue transition group transform hover:-translate-y-1">
                        <div class="text-4xl font-extrabold text-brand-navy group-hover:text-brand-blue transition">{{ stats.mux }}</div>
                        <div class="text-xs text-slate-400 font-bold uppercase mt-1">MUX Beroperasi</div>
                    </div>
                    <div class="col-span-2 bg-brand-navy p-8 rounded-2xl shadow-xl text-center text-white relative overflow-hidden group transform hover:-translate-y-1">
                        <div class="absolute top-0 right-0 w-40 h-40 bg-brand-blue rounded-full blur-3xl opacity-20 group-hover:opacity-40 transition"></div>
                        <div class="relative z-10">
                            <div class="text-6xl font-extrabold text-brand-sky mb-2 group-hover:scale-110 transition duration-300">{{ stats.channel }}</div>
                            <div class="text-sm text-slate-300 font-bold uppercase tracking-widest">Total Channel Nasional</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-20 bg-[#0f0f0f] border-y border-slate-800 relative overflow-hidden">
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full bg-gradient-to-b from-brand-blue/5 to-transparent pointer-events-none"></div>

    <div class="max-w-6xl mx-auto px-4 relative z-10">
        <div class="text-center mb-12">
            <span class="text-brand-sky font-bold text-[10px] uppercase tracking-[0.2em] bg-slate-800/80 px-3 py-1.5 rounded-full border border-slate-700 backdrop-blur-sm shadow-lg">Official Stream</span>
            <h2 class="text-2xl md:text-3xl font-bold text-white mt-4 font-youtube tracking-tight">Nonton Siaran TV FTA Indonesia</h2>
            <p class="text-gray-400 text-sm mt-2 max-w-2xl mx-auto font-youtube">Anda bisa menyaksikan Saluran pilihan TV FTA di Indonesia, kapan saja dimana saja dalam genggaman.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-12" id="tv-grid"></div>
    </div>
</section>

<section class="py-24 bg-white font-['Plus_Jakarta_Sans']">
    <div class="max-w-6xl mx-auto px-4">
        <div class="text-center mb-20">
            <h2 class="text-4xl font-extrabold text-brand-navy mb-6">Kenapa Harus TV Digital?</h2>
            <p class="text-slate-500 text-lg max-w-3xl mx-auto leading-relaxed">
                Dulu, nonton TV itu identik dengan gambar "semut". Kini, TV Digital hadir membawa revolusi kualitas gambar yang bening dan teknologi canggih—semuanya Gratis.
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-start">
            <div class="lg:col-span-7 space-y-10">
                <div class="flex gap-5">
                    <div class="flex-shrink-0 w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center text-brand-blue shadow-sm"><i class="fa-solid fa-tv text-xl"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-brand-navy mb-2">Bukan Streaming, Bukan Langganan</h3>
                        <p class="text-slate-600 leading-relaxed text-justify">TV Digital (DVB-T2) bukan streaming yang boros kuota, dan bukan TV kabel berbayar. Ini siaran terestrial biasa, tapi digital. Sekali beli perangkat, gratis selamanya.</p>
                    </div>
                </div>
                <div class="flex gap-5">
                    <div class="flex-shrink-0 w-12 h-12 rounded-xl bg-purple-100 flex items-center justify-center text-purple-600 shadow-sm"><i class="fa-solid fa-tower-cell text-xl"></i></div>
                    <div>
                        <h3 class="text-xl font-bold text-brand-navy mb-2">Konsep "MUX" (Bus Sekolah)</h3>
                        <p class="text-slate-600 leading-relaxed text-justify">MUX ibarat "Bus Sekolah". Satu frekuensi MUX bisa mengangkut 6-12 channel TV sekaligus dengan kualitas HD. Efisien dan banyak pilihan channel.</p>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5 space-y-4">
                <h3 class="text-lg font-bold text-slate-400 uppercase tracking-wider mb-4">Pertanyaan Populer</h3>
                <details class="group bg-white p-5 rounded-2xl border border-slate-200 shadow-sm open:shadow-md transition-all duration-300">
                    <summary class="flex justify-between items-center font-bold text-brand-navy cursor-pointer list-none select-none">
                        Kenapa Sinyal Saya "Cekot-Cekot"?
                        <span class="transition-transform duration-300 group-open:rotate-180 text-brand-blue"><i class="fa-solid fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-slate-600 text-sm mt-4 text-justify leading-relaxed border-t border-slate-100 pt-4">
                        <p>Masalah ini 95% karena instalasi antena. Solusi: Gunakan antena Outdoor (bukan indoor), ganti kabel RG6 baru, dan pastikan jack konektor tidak berkarat.</p>
                    </div>
                </details>
                <details class="group bg-white p-5 rounded-2xl border border-slate-200 shadow-sm open:shadow-md transition-all duration-300">
                    <summary class="flex justify-between items-center font-bold text-brand-navy cursor-pointer list-none select-none">
                        Cara Nonton Piala Dunia 2026?
                        <span class="transition-transform duration-300 group-open:rotate-180 text-brand-blue"><i class="fa-solid fa-chevron-down"></i></span>
                    </summary>
                    <div class="text-slate-600 text-sm mt-4 text-justify leading-relaxed border-t border-slate-100 pt-4">
                        <p>Hak siar UHF dipegang oleh <strong>TVRI</strong>. Arahkan antena ke pemancar TVRI terdekat untuk nonton Gratis dan HD.</p>
                    </div>
                </details>
                
                <div class="mt-8 pt-4">
                    <div class="bg-gradient-to-br from-brand-navy to-slate-800 text-white p-6 rounded-2xl relative overflow-hidden shadow-xl">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full blur-2xl -mr-10 -mt-10"></div>
                        <h4 class="font-bold text-lg mb-2 relative z-10">Masih Bingung?</h4>
                        <p class="text-sm text-slate-300 mb-4 relative z-10">Tanyakan masalah teknis Anda langsung ke tim komunitas.</p>
                        <a href="https://www.instagram.com/ktvdi.id" target="_blank" class="flex items-center justify-center gap-2 w-full bg-white text-brand-navy font-bold py-3 rounded-xl hover:bg-slate-100 transition relative z-10">
                            <i class="fa-brands fa-instagram"></i> DM Instagram
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const channels = [
            {name: "RTV HD-2", url: "https://rtvstream.rtv.co.id:4555/hls/rtv.m3u8"},
            {name: "Matrix TV Jogja", url: "https://stream.matrixtv.id/hls/stream.m3u8"},
            {name: "Berita Satu", url: "https://beritasatu.secureswiftcontent.com/han/beritasatu/bsatu10008/srtoutput/manifest.m3u8"},
            {name: "Nusantara TV", url: "https://nusantaratv.siar.us/nusantaratv/live/playlist.m3u8"},
            {name: "Semarang TV", url: "http://36.94.24.229/0.m3u8"},
            {name: "Caruban TV", url: "https://stream.carubantv.id/hls/stream.m3u8"},
            {name: "Stara TV Malang", url: "https://malang.staratv.id/hls/stream.m3u8"},
            {name: "TVRI Nasional", url: "https://ott-balancer.tvri.go.id/live/eds/Nasional/hls/Nasional.m3u8"},
            {name: "Garuda TV", url: "https://hgmtv.com:19360/garudatvlivestreaming/garudatvlivestreaming.m3u8"},
            {name: "Kompas TV HD", url: "https://www.youtube.com/live/DOOrIxw5xOw?si=JXBIKaInzJ5og-4F", type: "youtube"},
            {name: "Rasika USA TV", url: "https://rasika.siar.us/live/rasika.m3u8"}
        ];

        const grid = document.getElementById('tv-grid');
        
        channels.forEach((ch, idx) => {
            const div = document.createElement('div');
            div.className = "bg-transparent group mb-6";
            
            let playerContent = '';
            
            if (ch.type === "youtube") {
                playerContent = `<iframe src="https://www.youtube.com/embed/DOOrIxw5xOw?autoplay=0&mute=1" class="w-full h-full absolute inset-0 rounded-t-xl" frameborder="0" allowfullscreen></iframe>`;
            } else {
                playerContent = `
                    <div class="absolute inset-0 flex flex-col items-center justify-center bg-[#0f0f0f] z-20 loading-spinner transition-opacity duration-500 rounded-t-xl">
                        <img src="{{ url_for('static', filename='icons/icon-192.png') }}" class="w-10 h-auto animate-bounce mb-2 brightness-150">
                        <span class="text-[10px] text-gray-500 font-bold tracking-widest uppercase">Memuat...</span>
                    </div>
                    
                    <video id="vid-${idx}" class="w-full h-full object-cover rounded-t-xl" autoplay muted playsinline></video>

                    <div class="absolute inset-0 z-10 flex flex-col justify-between p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
                        
                        <div class="flex justify-end">
                            <button onclick="toggleFullScreen('vid-${idx}')" class="bg-black/50 hover:bg-black/80 text-white w-8 h-8 rounded-lg backdrop-blur-md pointer-events-auto transition flex items-center justify-center border border-white/10" title="Fullscreen">
                                <i class="fa-solid fa-expand text-xs"></i>
                            </button>
                        </div>

                        <div class="flex justify-center">
                            <button onclick="unmuteVideo('vid-${idx}', this)" class="group-video-unmute hidden pointer-events-auto bg-brand-blue/90 hover:bg-blue-600 text-white px-4 py-2 rounded-full font-bold text-xs shadow-lg backdrop-blur-sm transition transform hover:scale-105 flex items-center gap-2">
                                <i class="fa-solid fa-volume-high"></i> Bunyikan Suara
                            </button>
                        </div>
                        
                        <div></div>
                    </div>
                `;
            }

            div.innerHTML = `
                <div class="relative aspect-video bg-[#202020] rounded-t-xl overflow-hidden shadow-xl ring-1 ring-white/5">
                    ${playerContent}
                </div>

                <div class="bg-blue-900 border-t border-b border-white/10 h-6 flex items-center overflow-hidden relative">
                    <div class="absolute left-0 bg-blue-700 h-full px-2 flex items-center z-10 shadow-md">
                        <span class="text-[9px] font-bold text-white tracking-wider">INFO</span>
                    </div>
                    <div class="w-full h-full flex items-center">
                        <div class="animate-marquee-card text-[10px] text-blue-100 font-medium pl-4">
                            Tayangan LIVE Siaran TV di Website KTVDI ini kami tampilkan hanya pilihan, kami mengambil source dari website masing masing TV, bukan dari penyedia OTT dan dengan tujuan untuk memperkenalkan Siaran TV Digital ke kalangan Gen Z. Terima kasih.
                        </div>
                    </div>
                </div>
                
                <div class="pt-3 flex gap-3 bg-[#0f0f0f] rounded-b-xl px-1 pb-1">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-gray-400 border border-slate-700">
                            <i class="fa-solid fa-tv text-sm"></i>
                        </div>
                    </div>

                    <div class="flex-1">
                        <h3 class="text-white text-base font-bold font-youtube leading-tight mb-1 group-hover:text-brand-blue transition-colors line-clamp-1">${ch.name}</h3>
                        
                        <div class="flex flex-wrap items-center gap-2 text-[11px] text-gray-400 font-youtube font-medium">
                            ${ch.type !== 'youtube' ? `
                            <span class="text-red-500 font-bold flex items-center gap-1.5 bg-red-500/10 px-2 py-0.5 rounded border border-red-500/20">
                                <span class="relative flex h-1.5 w-1.5">
                                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                  <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-red-500"></span>
                                </span>
                                LIVE
                            </span>` : '<span class="bg-red-600 text-white px-1.5 py-0.5 rounded text-[10px] font-bold">YouTube</span>'}
                            
                            <span>• Indonesia</span>
                        </div>
                    </div>
                </div>
            `;
            
            grid.appendChild(div);

            if (ch.type !== "youtube") {
                const video = document.getElementById(`vid-${idx}`);
                const spinner = div.querySelector('.loading-spinner');
                const unmuteBtn = div.querySelector('.group-video-unmute');
                
                video.addEventListener('canplay', () => { 
                    spinner.style.opacity = '0'; 
                    setTimeout(() => spinner.remove(), 500); 
                    
                    if(video.muted) {
                        unmuteBtn.classList.remove('hidden');
                    }
                });
                
                video.addEventListener('waiting', () => { if(spinner) spinner.style.opacity = '1'; });
                
                video.addEventListener('volumechange', () => {
                    if(!video.muted) unmuteBtn.classList.add('hidden');
                });

                if(Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(ch.url);
                    hls.attachMedia(video);
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = ch.url;
                }
            }
        });
    });

    function unmuteVideo(id, btn) {
        const v = document.getElementById(id);
        if(v) {
            v.muted = false;
            v.volume = 1.0;
        }
    }

    function toggleFullScreen(id) {
        const v = document.getElementById(id);
        if (v.requestFullscreen) v.requestFullscreen();
        else if (v.webkitEnterFullscreen) v.webkitEnterFullscreen(); // iOS
        else if (v.msRequestFullscreen) v.msRequestFullscreen();
    }
</script>
{% endblock %}
